<!DOCTYPE html>
<html lang="cn" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="include: co/co.h.
#Âü∫Êú¨Ê¶ÇÂøµ ÂçèÁ®ãÊòØËøêË°å‰∫éÁ∫øÁ®ã‰∏≠ÁöÑËΩªÈáèÁ∫ßË∞ÉÂ∫¶Âçï‰Ωç„ÄÇ ÂçèÁ®ã‰πã‰∫éÁ∫øÁ®ãÔºåÁ±ª‰ºº‰∫éÁ∫øÁ®ã‰πã‰∫éËøõÁ®ã„ÄÇ ‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÂèØ‰ª•Â≠òÂú®Â§ö‰∏™Á∫øÁ®ãÔºå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÂèØ‰ª•Â≠òÂú®Â§ö‰∏™ÂçèÁ®ã„ÄÇ ÂçèÁ®ãÊâÄÂú®ÁöÑÁ∫øÁ®ã‰∏ÄËà¨Ë¢´Áß∞‰∏∫Ë∞ÉÂ∫¶Á∫øÁ®ã„ÄÇ ÂçèÁ®ãÂèëÁîü io ÈòªÂ°ûÊàñË∞ÉÁî® sleep Á≠âÊìç‰ΩúÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÊåÇËµ∑Ê≠§ÂçèÁ®ã„ÄÇ ÂçèÁ®ãÊåÇËµ∑Êó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ≠âÂæÖ‰∏≠ÁöÑÂçèÁ®ãËøêË°å„ÄÇ ÂçèÁ®ãÁöÑÂàáÊç¢ÊòØÂú®Áî®Êà∑ÊÄÅËøõË°åÁöÑÔºåÊØîÁ∫øÁ®ãÈó¥ÁöÑÂàáÊç¢Êõ¥Âø´„ÄÇ ÂçèÁ®ãÈùûÂ∏∏ÈÄÇÂêàÂÜôÁΩëÁªúÁ®ãÂ∫èÔºåÂèØ‰ª•ÂÆûÁé∞ÂêåÊ≠•ÁöÑÁºñÁ®ãÊñπÂºèÔºå‰∏çÈúÄË¶ÅÂºÇÊ≠•ÂõûË∞ÉÔºåÂ§ßÂ§ßÂáèËΩª‰∫ÜÁ®ãÂ∫èÂëòÁöÑÊÄùÊÉ≥Ë¥üÊãÖ„ÄÇ
co ÂçèÁ®ãÂ∫ìÂÆûÁé∞ÁöÑÊòØ‰∏ÄÁßçÁ±ª‰ºº golang ÁöÑÂçèÁ®ãÔºåÊúâÂ¶Ç‰∏ãÁâπÊÄßÔºö
ÊîØÊåÅÂ§öÁ∫øÁ®ãË∞ÉÂ∫¶ÔºåÈªòËÆ§Á∫øÁ®ãÊï∞‰∏∫Á≥ªÁªü CPU Ê†∏Êï∞„ÄÇ ÂÖ±‰∫´Ê†àÔºåÂêå‰∏ÄÁ∫øÁ®ã‰∏≠ÁöÑÂçèÁ®ãÂÖ±Áî®Ëã•Âπ≤‰∏™Ê†à(Â§ßÂ∞èÈªòËÆ§‰∏∫ 1MB)ÔºåÂÜÖÂ≠òÂç†Áî®‰ΩéÔºåLinux ‰∏äÁöÑÊµãËØïÊòæÁ§∫ 1000 ‰∏áÂçèÁ®ãÂè™Áî®‰∫Ü 2.8G ÂÜÖÂ≠ò(‰ªÖ‰æõÂèÇËÄÉ)„ÄÇ ÂçèÁ®ãÂàõÂª∫ÂêéÔºåÂßãÁªàÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÔºåËÄå‰∏ç‰ºöÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ ÂêÑÂçèÁ®ã‰πãÈó¥‰∏∫Âπ≥Á∫ßÂÖ≥Á≥ªÔºåÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞Êñπ(ÂåÖÊã¨Âú®ÂçèÁ®ã‰∏≠)ÂàõÂª∫Êñ∞ÁöÑÂçèÁ®ã„ÄÇ co ÂçèÁ®ãÂ∫ìÂú® linux, mac, windows Á≠âÂπ≥Âè∞ÔºåÂàÜÂà´Âü∫‰∫é epoll, kqueue, iocp ÂÆûÁé∞„ÄÇ
co ÂçèÁ®ãÂ∫ì‰∏≠ context ÂàáÊç¢Áõ∏ÂÖ≥ÁöÑ‰ª£Á†ÅÔºåÂèñËá™ ruki ÁöÑ tboxÔºåËÄå tbox ÂàôÂèÇËÄÉ‰∫Ü boost ÁöÑÂÆûÁé∞ÔºåÂú®Ê≠§Ë°®Á§∫ÊÑüË∞¢ÔºÅ
#ÂçèÁ®ã API #v3.0 Âà†Èô§ÁöÑ API co::init, v3.0 ÁßªÈô§Ôºå‰ªé co 3.0 ÂºÄÂßãÔºå‰∏ÄËà¨Âè™ÈúÄË¶ÅÂú® main ÂáΩÊï∞ÂºÄÂ§¥Ë∞ÉÁî® flag::init(argc, argv)„ÄÇ co::exit, v3.0 ÁßªÈô§„ÄÇ co::stop, v3.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="ÂçèÁ®ã" />
<meta property="og:description" content="include: co/co.h.
#Âü∫Êú¨Ê¶ÇÂøµ ÂçèÁ®ãÊòØËøêË°å‰∫éÁ∫øÁ®ã‰∏≠ÁöÑËΩªÈáèÁ∫ßË∞ÉÂ∫¶Âçï‰Ωç„ÄÇ ÂçèÁ®ã‰πã‰∫éÁ∫øÁ®ãÔºåÁ±ª‰ºº‰∫éÁ∫øÁ®ã‰πã‰∫éËøõÁ®ã„ÄÇ ‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÂèØ‰ª•Â≠òÂú®Â§ö‰∏™Á∫øÁ®ãÔºå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÂèØ‰ª•Â≠òÂú®Â§ö‰∏™ÂçèÁ®ã„ÄÇ ÂçèÁ®ãÊâÄÂú®ÁöÑÁ∫øÁ®ã‰∏ÄËà¨Ë¢´Áß∞‰∏∫Ë∞ÉÂ∫¶Á∫øÁ®ã„ÄÇ ÂçèÁ®ãÂèëÁîü io ÈòªÂ°ûÊàñË∞ÉÁî® sleep Á≠âÊìç‰ΩúÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÊåÇËµ∑Ê≠§ÂçèÁ®ã„ÄÇ ÂçèÁ®ãÊåÇËµ∑Êó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ≠âÂæÖ‰∏≠ÁöÑÂçèÁ®ãËøêË°å„ÄÇ ÂçèÁ®ãÁöÑÂàáÊç¢ÊòØÂú®Áî®Êà∑ÊÄÅËøõË°åÁöÑÔºåÊØîÁ∫øÁ®ãÈó¥ÁöÑÂàáÊç¢Êõ¥Âø´„ÄÇ ÂçèÁ®ãÈùûÂ∏∏ÈÄÇÂêàÂÜôÁΩëÁªúÁ®ãÂ∫èÔºåÂèØ‰ª•ÂÆûÁé∞ÂêåÊ≠•ÁöÑÁºñÁ®ãÊñπÂºèÔºå‰∏çÈúÄË¶ÅÂºÇÊ≠•ÂõûË∞ÉÔºåÂ§ßÂ§ßÂáèËΩª‰∫ÜÁ®ãÂ∫èÂëòÁöÑÊÄùÊÉ≥Ë¥üÊãÖ„ÄÇ
co ÂçèÁ®ãÂ∫ìÂÆûÁé∞ÁöÑÊòØ‰∏ÄÁßçÁ±ª‰ºº golang ÁöÑÂçèÁ®ãÔºåÊúâÂ¶Ç‰∏ãÁâπÊÄßÔºö
ÊîØÊåÅÂ§öÁ∫øÁ®ãË∞ÉÂ∫¶ÔºåÈªòËÆ§Á∫øÁ®ãÊï∞‰∏∫Á≥ªÁªü CPU Ê†∏Êï∞„ÄÇ ÂÖ±‰∫´Ê†àÔºåÂêå‰∏ÄÁ∫øÁ®ã‰∏≠ÁöÑÂçèÁ®ãÂÖ±Áî®Ëã•Âπ≤‰∏™Ê†à(Â§ßÂ∞èÈªòËÆ§‰∏∫ 1MB)ÔºåÂÜÖÂ≠òÂç†Áî®‰ΩéÔºåLinux ‰∏äÁöÑÊµãËØïÊòæÁ§∫ 1000 ‰∏áÂçèÁ®ãÂè™Áî®‰∫Ü 2.8G ÂÜÖÂ≠ò(‰ªÖ‰æõÂèÇËÄÉ)„ÄÇ ÂçèÁ®ãÂàõÂª∫ÂêéÔºåÂßãÁªàÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÔºåËÄå‰∏ç‰ºöÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ ÂêÑÂçèÁ®ã‰πãÈó¥‰∏∫Âπ≥Á∫ßÂÖ≥Á≥ªÔºåÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞Êñπ(ÂåÖÊã¨Âú®ÂçèÁ®ã‰∏≠)ÂàõÂª∫Êñ∞ÁöÑÂçèÁ®ã„ÄÇ co ÂçèÁ®ãÂ∫ìÂú® linux, mac, windows Á≠âÂπ≥Âè∞ÔºåÂàÜÂà´Âü∫‰∫é epoll, kqueue, iocp ÂÆûÁé∞„ÄÇ
co ÂçèÁ®ãÂ∫ì‰∏≠ context ÂàáÊç¢Áõ∏ÂÖ≥ÁöÑ‰ª£Á†ÅÔºåÂèñËá™ ruki ÁöÑ tboxÔºåËÄå tbox ÂàôÂèÇËÄÉ‰∫Ü boost ÁöÑÂÆûÁé∞ÔºåÂú®Ê≠§Ë°®Á§∫ÊÑüË∞¢ÔºÅ
#ÂçèÁ®ã API #v3.0 Âà†Èô§ÁöÑ API co::init, v3.0 ÁßªÈô§Ôºå‰ªé co 3.0 ÂºÄÂßãÔºå‰∏ÄËà¨Âè™ÈúÄË¶ÅÂú® main ÂáΩÊï∞ÂºÄÂ§¥Ë∞ÉÁî® flag::init(argc, argv)„ÄÇ co::exit, v3.0 ÁßªÈô§„ÄÇ co::stop, v3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://coostdocs.github.io/cn/co/coroutine/" /><meta property="article:section" content="co" />

<meta property="article:modified_time" content="2022-08-14T17:23:52+08:00" />

<title>ÂçèÁ®ã | Documents for Coost</title>
<link rel="manifest" href="../../../manifest.json">
<link rel="icon" href="../../../favicon.png" type="image/x-icon">
  <link rel="alternate" hreflang="en" href="https://coostdocs.github.io/en/co/coroutine/" title="Coroutine">
<link rel="stylesheet" href="../../../book.min.0608a3570dae40fa4b3de520d6a873cc9855bb4cb5001c4b16e95a226b84aff8.css" integrity="sha256-BgijVw2uQPpLPeUg1qhzzJhVu0y1ABxLFulaImuEr/g=" crossorigin="anonymous">
  <script defer src="../../../flexsearch.min.js"></script>
  <script defer src="../../../cn.search.min.aa8a3c91aca1dc000ce777789927731dbb4ddb666a8b6ac6249844476bf2f98a.js" integrity="sha256-qoo8kayh3AAM53d4mSdzHbtN22Zqi2rGJJhER2vy&#43;Yo=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  


<link href='//cdn.bootcss.com/highlight.js/11.1.0/styles/github.min.css'
  rel='stylesheet' type='text/css' />


</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="../../../cn/"><span>Documents for Coost</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="ÊêúÁ¥¢" aria-label="ÊêúÁ¥¢" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>ÂÖ≥‰∫é</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="../../../cn/about/co/" class="">ÁÆÄ‰ªã</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/about/contact/" class="">ËÅîÁ≥ª</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/about/sponsor/" class="">ËµûÂä©üíï</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>CO ÂèÇËÄÉÊñáÊ°£</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/def/" class="">Âü∫Êú¨ÂÆö‰πâ</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/defer/" class="">defer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/atomic/" class="">ÂéüÂ≠êÊìç‰Ωú</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/fastring/" class="">Â≠óÁ¨¶‰∏≤(fastring)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/fastream/" class="">Â≠óÁ¨¶ÊµÅ(fastream)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/str/" class="">Â≠óÁ¨¶‰∏≤Êìç‰Ωú</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/flag/" class="">ÂëΩ‰ª§Ë°åÂèÇÊï∞‰∏éÈÖçÁΩÆÊñá‰ª∂Ëß£Êûê</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/log/" class="">Êó•Âøó</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/unitest/" class="">ÂçïÂÖÉÊµãËØïÊ°ÜÊû∂</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/json/" class="">JSON</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/time/" class="">Êó∂Èó¥</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/thread/" class="">Á∫øÁ®ã</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/coroutine/" class=" active">ÂçèÁ®ã</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-752f64a904309658adbf6062b2c3d8c1" class="toggle"  />
    <label for="section-752f64a904309658adbf6062b2c3d8c1" class="flex justify-between">
      <a role="button" class="">ÁΩëÁªúÁºñÁ®ã</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/net/byte_order/" class="">Â≠óËäÇÂ∫è</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/net/tcp/" class="">TCP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/net/http/" class="">HTTP</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/net/rpc/" class="">RPC</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/tasked/" class="">ÂÆöÊó∂‰ªªÂä°</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/random/" class="">ÈöèÊú∫Êï∞</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/lrumap/" class="">LruMap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/hash/" class="">Hash</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/path/" class="">Êñá‰ª∂Ë∑ØÂæÑ(path)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/fs/" class="">Êñá‰ª∂Á≥ªÁªü</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/os/" class="">Êìç‰ΩúÁ≥ªÁªü</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../../cn/co/build/" class="">ÁºñËØë</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="../../../svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>ÂçèÁ®ã</strong>

  <label for="toc-control">
    
    <img src="../../../svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#Âü∫Êú¨Ê¶ÇÂøµ">Âü∫Êú¨Ê¶ÇÂøµ</a></li>
        <li><a href="#ÂçèÁ®ã-api">ÂçèÁ®ã API</a>
          <ul>
            <li><a href="#v30-Âà†Èô§ÁöÑ-api">v3.0 Âà†Èô§ÁöÑ API</a></li>
            <li><a href="#go">go</a></li>
            <li><a href="#def_main">DEF_main</a></li>
            <li><a href="#cocoroutine">co::coroutine</a></li>
            <li><a href="#coresume">co::resume</a></li>
            <li><a href="#coyield">co::yield</a></li>
            <li><a href="#coscheduler">co::scheduler</a></li>
            <li><a href="#coschedulers">co::schedulers</a></li>
            <li><a href="#conext_scheduler">co::next_scheduler</a></li>
            <li><a href="#coscheduler_num">co::scheduler_num</a></li>
            <li><a href="#coscheduler_id">co::scheduler_id</a></li>
            <li><a href="#cocoroutine_id">co::coroutine_id</a></li>
            <li><a href="#cosleep">co::sleep</a></li>
            <li><a href="#cotimeout">co::timeout</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÂåñÁöÑ-socket-api">ÂçèÁ®ãÂåñÁöÑ socket API</a>
          <ul>
            <li><a href="#ÊúØËØ≠Á∫¶ÂÆöÂøÖÁúã">ÊúØËØ≠Á∫¶ÂÆö(ÂøÖÁúã)</a></li>
            <li><a href="#cosocket">co::socket</a></li>
            <li><a href="#coaccept">co::accept</a></li>
            <li><a href="#cobind">co::bind</a></li>
            <li><a href="#coclose">co::close</a></li>
            <li><a href="#coconnect">co::connect</a></li>
            <li><a href="#colisten">co::listen</a></li>
            <li><a href="#corecv">co::recv</a></li>
            <li><a href="#corecvn">co::recvn</a></li>
            <li><a href="#corecvfrom">co::recvfrom</a></li>
            <li><a href="#cosend">co::send</a></li>
            <li><a href="#cosendto">co::sendto</a></li>
            <li><a href="#coshutdown">co::shutdown</a></li>
            <li><a href="#coerror">co::error</a></li>
            <li><a href="#costrerror">co::strerror</a></li>
            <li><a href="#heading">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</a></li>
            <li><a href="#cogetsockopt">co::getsockopt</a></li>
            <li><a href="#cosetsockopt">co::setsockopt</a></li>
            <li><a href="#coset_nonblock">co::set_nonblock</a></li>
            <li><a href="#coset_reuseaddr">co::set_reuseaddr</a></li>
            <li><a href="#coset_recv_buffer_size">co::set_recv_buffer_size</a></li>
            <li><a href="#coset_send_buffer_size">co::set_send_buffer_size</a></li>
            <li><a href="#coset_tcp_keepalive">co::set_tcp_keepalive</a></li>
            <li><a href="#coset_tcp_nodelay">co::set_tcp_nodelay</a></li>
            <li><a href="#coreset_tcp_socket">co::reset_tcp_socket</a></li>
            <li><a href="#heading-1">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</a></li>
            <li><a href="#coinit_ip_addr">co::init_ip_addr</a></li>
            <li><a href="#coip_str">co::ip_str</a></li>
            <li><a href="#coto_string">co::to_string</a></li>
            <li><a href="#copeer">co::peer</a></li>
          </ul>
        </li>
        <li><a href="#channelcochan">channel(co::Chan)</a>
          <ul>
            <li><a href="#chanchan">Chan::Chan</a></li>
            <li><a href="#operator">operator&laquo;</a></li>
            <li><a href="#operator-1">operator&raquo;</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-1">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÂêåÊ≠•‰∫ã‰ª∂coevent">ÂçèÁ®ãÂêåÊ≠•‰∫ã‰ª∂(co::Event)</a>
          <ul>
            <li><a href="#eventevent">Event::Event</a></li>
            <li><a href="#eventsignal">Event::signal</a></li>
            <li><a href="#eventwait">Event::wait</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-2">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#waitgroupcowaitgroup">waitgroup(co::WaitGroup)</a>
          <ul>
            <li><a href="#waitgroupwaitgroup">WaitGroup::WaitGroup</a></li>
            <li><a href="#waitgroupadd">WaitGroup::add</a></li>
            <li><a href="#waitgroupdone">WaitGroup::done</a></li>
            <li><a href="#waitgroupwait">WaitGroup::wait</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-3">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÈîÅcomutex">ÂçèÁ®ãÈîÅ(co::Mutex)</a>
          <ul>
            <li><a href="#mutexmutex">Mutex::Mutex</a></li>
            <li><a href="#mutexlock">Mutex::lock</a></li>
            <li><a href="#mutextry_lock">Mutex::try_lock</a></li>
            <li><a href="#mutexunlock">Mutex::unlock</a></li>
          </ul>
        </li>
        <li><a href="#comutexguard">co::MutexGuard</a>
          <ul>
            <li><a href="#mutexguardmutexguard">MutexGuard::MutexGuard</a></li>
            <li><a href="#mutexguardmutexguard-1">MutexGuard::~MutexGuard</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-4">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÊ±†copool">ÂçèÁ®ãÊ±†(co::Pool)</a>
          <ul>
            <li><a href="#poolpool">Pool::Pool</a></li>
            <li><a href="#poolclear">Pool::clear</a></li>
            <li><a href="#poolpop">Pool::pop</a></li>
            <li><a href="#poolpush">Pool::push</a></li>
            <li><a href="#poolsize">Pool::size</a></li>
          </ul>
        </li>
        <li><a href="#copoolguard">co::PoolGuard</a>
          <ul>
            <li><a href="#poolguardpoolguard">PoolGuard::PoolGuard</a></li>
            <li><a href="#poolguardpoolguard-1">PoolGuard::~PoolGuard</a></li>
            <li><a href="#poolguardget">PoolGuard::get</a></li>
            <li><a href="#poolguardoperator-">PoolGuard::operator-&gt;</a></li>
            <li><a href="#poolguardoperator">PoolGuard::operator*</a></li>
            <li><a href="#poolguardoperator-bool">PoolGuard::operator bool</a></li>
            <li><a href="#poolguardoperator-1">PoolGuard::operator!</a></li>
            <li><a href="#poolguardoperator-2">PoolGuard::operator==</a></li>
            <li><a href="#poolguardoperator-3">PoolGuard::operator!=</a></li>
            <li><a href="#poolguardoperator-4">PoolGuard::operator=</a></li>
            <li><a href="#poolguardreset">PoolGuard::reset</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-5">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#io-‰∫ã‰ª∂coioevent">I/O ‰∫ã‰ª∂(co::IoEvent)</a>
          <ul>
            <li><a href="#coio_event_t">co::io_event_t</a></li>
            <li><a href="#ioeventioevent">IoEvent::IoEvent</a></li>
            <li><a href="#ioeventioevent-1">IoEvent::~IoEvent</a></li>
            <li><a href="#ioeventwait">IoEvent::wait</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-6">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ã‰∏≠‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ì">ÂçèÁ®ã‰∏≠‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ì</a>
          <ul>
            <li><a href="#ÂçèÁ®ãÂåñ">ÂçèÁ®ãÂåñ</a></li>
            <li><a href="#Á≥ªÁªü-api-hook">Á≥ªÁªü API hook</a></li>
          </ul>
        </li>
        <li><a href="#Âü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ãÊ®°Âºè">Âü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ãÊ®°Âºè</a>
          <ul>
            <li><a href="#ÊúçÂä°Á´ØÁΩëÁªúÊ®°Âûã">ÊúçÂä°Á´ØÁΩëÁªúÊ®°Âûã</a></li>
            <li><a href="#ÂÆ¢Êà∑Á´ØÁΩëÁªúÊ®°Âûã">ÂÆ¢Êà∑Á´ØÁΩëÁªúÊ®°Âûã</a></li>
          </ul>
        </li>
        <li><a href="#ÈÖçÁΩÆ">ÈÖçÁΩÆ</a>
          <ul>
            <li><a href="#co_debug_log">co_debug_log</a></li>
            <li><a href="#co_sched_num">co_sched_num</a></li>
            <li><a href="#co_stack_size">co_stack_size</a></li>
            <li><a href="#disable_hook_sleep">disable_hook_sleep</a></li>
            <li><a href="#hook_log">hook_log</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><p>include: <a href="https://github.com/idealvin/co/blob/master/include/co/co.h">co/co.h</a>.</p>
<h2 id="Âü∫Êú¨Ê¶ÇÂøµ"><a class="anchor" href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5">#</a>Âü∫Êú¨Ê¶ÇÂøµ</h2>
<ul>
<li>ÂçèÁ®ãÊòØËøêË°å‰∫éÁ∫øÁ®ã‰∏≠ÁöÑËΩªÈáèÁ∫ßË∞ÉÂ∫¶Âçï‰Ωç„ÄÇ</li>
<li>ÂçèÁ®ã‰πã‰∫éÁ∫øÁ®ãÔºåÁ±ª‰ºº‰∫éÁ∫øÁ®ã‰πã‰∫éËøõÁ®ã„ÄÇ</li>
<li>‰∏Ä‰∏™ËøõÁ®ã‰∏≠ÂèØ‰ª•Â≠òÂú®Â§ö‰∏™Á∫øÁ®ãÔºå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ÂèØ‰ª•Â≠òÂú®Â§ö‰∏™ÂçèÁ®ã„ÄÇ</li>
<li>ÂçèÁ®ãÊâÄÂú®ÁöÑÁ∫øÁ®ã‰∏ÄËà¨Ë¢´Áß∞‰∏∫<strong>Ë∞ÉÂ∫¶Á∫øÁ®ã</strong>„ÄÇ</li>
<li>ÂçèÁ®ãÂèëÁîü io ÈòªÂ°ûÊàñË∞ÉÁî® sleep Á≠âÊìç‰ΩúÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÊåÇËµ∑Ê≠§ÂçèÁ®ã„ÄÇ</li>
<li>ÂçèÁ®ãÊåÇËµ∑Êó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ≠âÂæÖ‰∏≠ÁöÑÂçèÁ®ãËøêË°å„ÄÇ</li>
<li>ÂçèÁ®ãÁöÑÂàáÊç¢ÊòØÂú®Áî®Êà∑ÊÄÅËøõË°åÁöÑÔºåÊØîÁ∫øÁ®ãÈó¥ÁöÑÂàáÊç¢Êõ¥Âø´„ÄÇ</li>
</ul>
<p>ÂçèÁ®ãÈùûÂ∏∏ÈÄÇÂêàÂÜôÁΩëÁªúÁ®ãÂ∫èÔºåÂèØ‰ª•ÂÆûÁé∞<strong>ÂêåÊ≠•ÁöÑÁºñÁ®ãÊñπÂºè</strong>Ôºå‰∏çÈúÄË¶ÅÂºÇÊ≠•ÂõûË∞ÉÔºåÂ§ßÂ§ßÂáèËΩª‰∫ÜÁ®ãÂ∫èÂëòÁöÑÊÄùÊÉ≥Ë¥üÊãÖ„ÄÇ</p>
<p>co ÂçèÁ®ãÂ∫ìÂÆûÁé∞ÁöÑÊòØ‰∏ÄÁßçÁ±ª‰ºº <a href="https://github.com/golang/go/">golang</a> ÁöÑÂçèÁ®ãÔºåÊúâÂ¶Ç‰∏ãÁâπÊÄßÔºö</p>
<ul>
<li>ÊîØÊåÅÂ§öÁ∫øÁ®ãË∞ÉÂ∫¶ÔºåÈªòËÆ§Á∫øÁ®ãÊï∞‰∏∫Á≥ªÁªü CPU Ê†∏Êï∞„ÄÇ</li>
<li>ÂÖ±‰∫´Ê†àÔºåÂêå‰∏ÄÁ∫øÁ®ã‰∏≠ÁöÑÂçèÁ®ãÂÖ±Áî®Ëã•Âπ≤‰∏™Ê†à(Â§ßÂ∞èÈªòËÆ§‰∏∫ 1MB)ÔºåÂÜÖÂ≠òÂç†Áî®‰ΩéÔºåLinux ‰∏äÁöÑÊµãËØïÊòæÁ§∫ 1000 ‰∏áÂçèÁ®ãÂè™Áî®‰∫Ü 2.8G ÂÜÖÂ≠ò(‰ªÖ‰æõÂèÇËÄÉ)„ÄÇ</li>
<li>ÂçèÁ®ãÂàõÂª∫ÂêéÔºåÂßãÁªàÂú®Âêå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÔºåËÄå‰∏ç‰ºöÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ</li>
<li>ÂêÑÂçèÁ®ã‰πãÈó¥‰∏∫Âπ≥Á∫ßÂÖ≥Á≥ªÔºåÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞Êñπ(ÂåÖÊã¨Âú®ÂçèÁ®ã‰∏≠)ÂàõÂª∫Êñ∞ÁöÑÂçèÁ®ã„ÄÇ</li>
</ul>
<p>co ÂçèÁ®ãÂ∫ìÂú® linux, mac, windows Á≠âÂπ≥Âè∞ÔºåÂàÜÂà´Âü∫‰∫é <a href="http://man7.org/linux/man-pages/man7/epoll.7.html">epoll</a>, <a href="https://man.openbsd.org/kqueue.2">kqueue</a>, <a href="https://docs.microsoft.com/en-us/windows/win32/fileio/i-o-completion-ports">iocp</a> ÂÆûÁé∞„ÄÇ</p>
<p>co ÂçèÁ®ãÂ∫ì‰∏≠ context ÂàáÊç¢Áõ∏ÂÖ≥ÁöÑ‰ª£Á†ÅÔºåÂèñËá™ <a href="https://github.com/waruqi">ruki</a> ÁöÑ <a href="https://github.com/tboox/tbox/">tbox</a>ÔºåËÄå tbox ÂàôÂèÇËÄÉ‰∫Ü <a href="https://www.boost.org/doc/libs/1_70_0/libs/context/doc/html/index.html">boost</a> ÁöÑÂÆûÁé∞ÔºåÂú®Ê≠§Ë°®Á§∫ÊÑüË∞¢ÔºÅ</p>
<h2 id="ÂçèÁ®ã-api"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b-api">#</a>ÂçèÁ®ã API</h2>
<h3 id="v30-Âà†Èô§ÁöÑ-api"><a class="anchor" href="#v30-%e5%88%a0%e9%99%a4%e7%9a%84-api">#</a>v3.0 Âà†Èô§ÁöÑ API</h3>
<ul>
<li><strong>co::init</strong>, v3.0 ÁßªÈô§Ôºå‰ªé co 3.0 ÂºÄÂßãÔºå‰∏ÄËà¨Âè™ÈúÄË¶ÅÂú® main ÂáΩÊï∞ÂºÄÂ§¥Ë∞ÉÁî® <code>flag::init(argc, argv)</code>„ÄÇ</li>
<li><strong>co::exit</strong>, v3.0 ÁßªÈô§„ÄÇ</li>
<li><strong>co::stop</strong>, v3.0 ÁßªÈô§„ÄÇ</li>
<li><strong>co::all_schedulers</strong>, v3.0 ÈáçÂëΩÂêç‰∏∫ <a href="#coschedulers">co::schedulers</a>„ÄÇ</li>
</ul>
<h3 id="go"><a class="anchor" href="#go">#</a>go</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">go</span>(Closure<span style="color:#000;font-weight:bold">*</span> cb);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> F<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#458;font-weight:bold">void</span> go(F<span style="color:#000;font-weight:bold">&amp;&amp;</span> f);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> F, <span style="color:#000;font-weight:bold">typename</span> P<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#458;font-weight:bold">void</span> go(F<span style="color:#000;font-weight:bold">&amp;&amp;</span> f, P<span style="color:#000;font-weight:bold">&amp;&amp;</span> p);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> F, <span style="color:#000;font-weight:bold">typename</span> T, <span style="color:#000;font-weight:bold">typename</span> P<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#458;font-weight:bold">void</span> go(F<span style="color:#000;font-weight:bold">&amp;&amp;</span> f, T<span style="color:#000;font-weight:bold">*</span> t, P<span style="color:#000;font-weight:bold">&amp;&amp;</span> p);
</span></span></code></pre></div><ul>
<li>
<p>Ê≠§ÂáΩÊï∞Áî®‰∫é<strong>ÂàõÂª∫ÂçèÁ®ã</strong>Ôºå‰∏éÂàõÂª∫Á∫øÁ®ãÁ±ª‰ººÔºåÈúÄË¶ÅÊåáÂÆö‰∏Ä‰∏™ÂçèÁ®ãÂáΩÊï∞„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 1 ‰∏™ÁâàÊú¨‰∏≠ÔºåÂèÇÊï∞ cb ÊåáÂêë‰∏Ä‰∏™ Closure ÂØπË±°ÔºåÂçèÁ®ãÂêØÂä®Âêé‰ºöË∞ÉÁî® Closure ‰∏≠ÁöÑ <code>run()</code>¬†ÊñπÊ≥ï„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 2-4 ‰∏™ÁâàÊú¨ÔºåÂ∞Ü‰º†ÂÖ•ÁöÑÂèÇÊï∞ÊâìÂåÖÊàê‰∏Ä‰∏™ ClosureÔºåÁÑ∂ÂêéË∞ÉÁî®Á¨¨ 1 ‰∏™ÁâàÊú¨„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 2 ‰∏™ÁâàÊú¨‰∏≠ÔºåÂèÇÊï∞ f ÊòØ‰ªªÊÑèÂèØË∞ÉÁî®ÁöÑÂØπË±°ÔºåÂè™Ë¶ÅËÉΩË∞ÉÁî® <code>f()</code>¬†Êàñ <code>(*f)()</code>¬†Â∞±Ë°å„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 3 ‰∏™ÁâàÊú¨‰∏≠ÔºåÂèÇÊï∞ f ÊòØ‰ªªÊÑèÂèØË∞ÉÁî®ÁöÑÂØπË±°ÔºåÂè™Ë¶ÅËÉΩË∞ÉÁî® <code>f(p)</code>, <code>(*f)(p)</code>¬†Êàñ <code>(p-&gt;*f)()</code>¬†Â∞±Ë°å„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 4 ‰∏™ÁâàÊú¨‰∏≠ÔºåÂèÇÊï∞ f ÊòØÁ±ª‰∏≠Â∏¶‰∏Ä‰∏™ÂèÇÊï∞ÁöÑÊñπÊ≥ï <code>void T::f(P)</code>ÔºåÂèÇÊï∞ t ÊòØ <code>T</code>¬†Á±ªÂûãÁöÑÊåáÈíàÔºåÂèÇÊï∞ p ÊòØÊñπÊ≥ï f ÁöÑÂèÇÊï∞„ÄÇ</p>
</li>
<li>
<p>ÂÆûÈôÖÊµãËØïÂèëÁé∞ÔºåÂàõÂª∫ <code>std::function</code> Á±ªÂûãÁöÑÂØπË±°ÂºÄÈîÄËæÉÂ§ßÔºåÂ∫îÂ∞ΩÈáèÂ∞ëÁî®„ÄÇ</p>
</li>
<li>
<p>‰∏•Ê†ºÊù•ËØ¥Ôºågo() Âè™ÊòØÂ∞Ü Closure ÂàÜÈÖçÂà∞‰∏Ä‰∏™Ë∞ÉÂ∫¶Á∫øÁ®ã‰∏≠ÔºåÁúüÊ≠£ÂàõÂª∫ÂçèÁ®ãÊòØÁî±Ë∞ÉÂ∫¶Á∫øÁ®ãÂÆåÊàêÁöÑ„ÄÇ‰ΩÜ‰ªéÁî®Êà∑ÁöÑËßíÂ∫¶ÁúãÔºåÈÄªËæë‰∏äÂèØ‰ª•ËÆ§‰∏∫ go() ÂàõÂª∫‰∫ÜÂçèÁ®ã„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>go(f);             <span style="color:#998;font-style:italic">// void f();
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>go(f, <span style="color:#099">7</span>);          <span style="color:#998;font-style:italic">// void f(int);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>go(<span style="color:#000;font-weight:bold">&amp;</span>T<span style="color:#000;font-weight:bold">::</span>f, <span style="color:#000;font-weight:bold">&amp;</span>o);     <span style="color:#998;font-style:italic">// void T::f();    T o;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>go(<span style="color:#000;font-weight:bold">&amp;</span>T<span style="color:#000;font-weight:bold">::</span>f, <span style="color:#000;font-weight:bold">&amp;</span>o, <span style="color:#099">3</span>);  <span style="color:#998;font-style:italic">// void T::f(int); T o;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// lambda
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>go([](){
</span></span><span style="display:flex;"><span>    LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;hello co&#34;</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// std::function
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>std<span style="color:#000;font-weight:bold">::</span>function<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span>()<span style="color:#000;font-weight:bold">&gt;</span> x(std<span style="color:#000;font-weight:bold">::</span>bind(f, <span style="color:#099">7</span>));
</span></span><span style="display:flex;"><span>go(x);
</span></span><span style="display:flex;"><span>go(<span style="color:#000;font-weight:bold">&amp;</span>x); <span style="color:#998;font-style:italic">// Ensure that x is alive when the coroutine is running.
</span></span></span></code></pre></div><h3 id="def_main"><a class="anchor" href="#def_main">#</a>DEF_main</h3>
<p>Ëøô‰∏™ÂÆèÁî®‰∫éÂÆö‰πâ main ÂáΩÊï∞ÔºåÂπ∂Â∞Ü main ÂáΩÊï∞‰∏≠ÁöÑ‰ª£Á†Å‰πüÊîæÂà∞ÂçèÁ®ã‰∏≠ËøêË°å„ÄÇDEF_main ÂÜÖÈÉ®Â∑≤ÁªèË∞ÉÁî® <code>flag::init(argc, argv)</code> ËøõË°åÂàùÂßãÂåñÔºåÁî®Êà∑Êó†ÈúÄÂÜçÊ¨°Ë∞ÉÁî®„ÄÇ</p>
<ul>
<li>Á§∫‰æã</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DEF_main(argc, argv) {
</span></span><span style="display:flex;"><span>    go([](){
</span></span><span style="display:flex;"><span>        LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;hello world&#34;</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>sleep(<span style="color:#099">100</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="cocoroutine"><a class="anchor" href="#cocoroutine">#</a>co::coroutine</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">coroutine</span>();
</span></span></code></pre></div><ul>
<li>ËøîÂõûÂΩìÂâçÁöÑ coroutine ÊåáÈíàÔºåËã•Âú®ÈùûÂçèÁ®ã‰∏≠Ë∞ÉÁî®Ê≠§ÂáΩÊï∞ÔºåÂàôËøîÂõûÂÄºÊòØ NULL„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÁöÑËøîÂõûÂÄºÔºåÂèØ‰Ωú‰∏∫ <a href="#coresume">co::resume()</a> ÁöÑÂèÇÊï∞ÔºåÁî®‰∫éÂî§ÈÜíÂçèÁ®ã„ÄÇ</li>
</ul>
<h3 id="coresume"><a class="anchor" href="#coresume">#</a>co::resume</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">resume</span>(<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> p);
</span></span></code></pre></div><ul>
<li>Âî§ÈÜíÊåáÂÆöÁöÑÂçèÁ®ãÔºåÂèÇÊï∞ <code>p</code> ÊòØ <a href="#cocoroutine">co::coroutine()</a> ÁöÑËøîÂõûÂÄº„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂèØÂú®‰ªªÊÑèÂú∞ÊñπË∞ÉÁî®„ÄÇ</li>
</ul>
<h3 id="coyield"><a class="anchor" href="#coyield">#</a>co::yield</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">yield</span>();
</span></span></code></pre></div><ul>
<li>ÊåÇËµ∑ÂΩìÂâçÂçèÁ®ãÔºåÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÈÖçÂêà <a href="#cocoroutine">co::coroutine()</a> ‰∏é <a href="#coresume">co::resume()</a>ÔºåÂèØ‰ª•ÊâãÂä®ÊéßÂà∂ÂçèÁ®ãÁöÑË∞ÉÂ∫¶ÔºåËØ¶ÊÉÖÂèÇËÄÉ <a href="https://github.com/idealvin/coost/blob/master/test/yield.cc">test/yield.cc</a>„ÄÇ</li>
</ul>
<h3 id="coscheduler"><a class="anchor" href="#coscheduler">#</a>co::scheduler</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Scheduler<span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">scheduler</span>();
</span></span></code></pre></div><ul>
<li>ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁöÑ scheduler ÊåáÈíàÔºåÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã‰∏çÊòØË∞ÉÂ∫¶Á∫øÁ®ãÔºåËøîÂõûÂÄºÊòØ NULL„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰∏ÄËà¨Âú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®ÔºåÁî®‰∫éËé∑ÂèñÂΩìÂâçÂçèÁ®ãÊâÄÂú®ÁöÑ scheduler„ÄÇ</li>
</ul>
<h3 id="coschedulers"><a class="anchor" href="#coschedulers">#</a>co::schedulers</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">const</span> co<span style="color:#000;font-weight:bold">::</span>vector<span style="color:#000;font-weight:bold">&lt;</span>Scheduler<span style="color:#000;font-weight:bold">*&gt;&amp;</span> schedulers();
</span></span></code></pre></div><ul>
<li>ËøîÂõû Scheduler ÂàóË°®ÁöÑÂºïÁî®Ôºå‰∏Ä‰∏™ Scheduler ÂØπÂ∫î‰∏Ä‰∏™Ë∞ÉÂ∫¶Á∫øÁ®ã„ÄÇ</li>
</ul>
<h3 id="conext_scheduler"><a class="anchor" href="#conext_scheduler">#</a>co::next_scheduler</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Scheduler<span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">next_scheduler</span>();
</span></span></code></pre></div><ul>
<li>
<p>Ê≠§ÂáΩÊï∞ËøîÂõû‰∏ã‰∏Ä‰∏™ Scheduler ÊåáÈíà„ÄÇ</p>
</li>
<li>
<p><code>go(...)</code>¬†ÂÆûÈôÖ‰∏äÁ≠â‰ª∑‰∫é <code>co::next_scheduler()-&gt;go(...)</code>„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ÂàõÂª∫Âú®Âêå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠ËøêË°åÁöÑÂçèÁ®ã
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">auto</span> s <span style="color:#000;font-weight:bold">=</span> co<span style="color:#000;font-weight:bold">::</span>next_scheduler();
</span></span><span style="display:flex;"><span>s<span style="color:#000;font-weight:bold">-&gt;</span>go(f1);
</span></span><span style="display:flex;"><span>s<span style="color:#000;font-weight:bold">-&gt;</span>go(f2);
</span></span></code></pre></div><h3 id="coscheduler_num"><a class="anchor" href="#coscheduler_num">#</a>co::scheduler_num</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">scheduler_num</span>();
</span></span></code></pre></div><ul>
<li>
<p>ËøîÂõû scheduler ÁöÑÊï∞ÈáèÔºåÊ≠§ÂáΩÊï∞Â∏∏Áî®‰∫éÂÆûÁé∞‰∏Ä‰∫õÂçèÁ®ãÂÆâÂÖ®ÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>vector<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> v(co<span style="color:#000;font-weight:bold">::</span>scheduler_num());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">f</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// get object for the current scheduler
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">auto</span><span style="color:#000;font-weight:bold">&amp;</span> t <span style="color:#000;font-weight:bold">=</span> v[co<span style="color:#000;font-weight:bold">::</span>scheduler_id()];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(f);
</span></span></code></pre></div><h3 id="coscheduler_id"><a class="anchor" href="#coscheduler_id">#</a>co::scheduler_id</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">scheduler_id</span>();
</span></span></code></pre></div><ul>
<li>ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁöÑ scheduler idÔºåËøô‰∏™ÂÄºÊòØ 0 Âà∞ <code>co::scheduler_num()-1</code>¬†‰πãÈó¥ÁöÑÂÄº„ÄÇÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ã‰∏çÊòØË∞ÉÂ∫¶Á∫øÁ®ãÔºåËøîÂõûÂÄºÊòØ -1„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰∏ÄËà¨Âú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®ÔºåÁî®‰∫éËé∑ÂèñÂΩìÂâçÂçèÁ®ãÊâÄÂú®ÁöÑ scheduler id„ÄÇ</li>
</ul>
<h3 id="cocoroutine_id"><a class="anchor" href="#cocoroutine_id">#</a>co::coroutine_id</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">coroutine_id</span>();
</span></span></code></pre></div><ul>
<li>Ê≠§ÂáΩÊï∞ËøîÂõûÂΩìÂâçÂçèÁ®ãÁöÑ idÔºå‰∏çÂêåÂçèÁ®ãÊúâ‰∏çÂêåÁöÑ id„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰∏ÄËà¨Âú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®ÔºåÂú®ÈùûÂçèÁ®ã‰∏≠Ë∞ÉÁî®Êó∂ÔºåËøîÂõûÂÄºÊòØ -1„ÄÇ</li>
<li>ÂçèÁ®ã id ‰∏é scheduler id ÊúâÁùÄÁÆÄÂçïÁöÑÁ∫øÊÄßÂØπÂ∫îÂÖ≥Á≥ª„ÄÇÂÅáËÆæÊúâ 4 ‰∏™ schedulerÔºåid ÂàÜÂà´ÊòØ 0, 1, 2, 3ÔºåËøô‰∫õ scheduler ÂÜÖÁöÑÂçèÁ®ã id ÂàÜÂà´ÊòØÔºö</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#099">4</span>k        (<span style="color:#099">0</span>, <span style="color:#099">4</span>, <span style="color:#099">8</span>, ...)
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>k <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">1</span>    (<span style="color:#099">1</span>, <span style="color:#099">5</span>, <span style="color:#099">9</span>, ...)
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>k <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">2</span>    (<span style="color:#099">2</span>, <span style="color:#099">6</span>, <span style="color:#099">10</span>, ...)
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>k <span style="color:#000;font-weight:bold">+</span> <span style="color:#099">3</span>    (<span style="color:#099">3</span>, <span style="color:#099">7</span>, <span style="color:#099">11</span>, ...)
</span></span></code></pre></div><h3 id="cosleep"><a class="anchor" href="#cosleep">#</a>co::sleep</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sleep</span>(uint32 ms);
</span></span></code></pre></div><ul>
<li>ËÆ©ÂΩìÂâçÂçèÁ®ãÁù°‰∏Ä‰ºöÂÑøÔºåÂèÇÊï∞ ms ÊòØÊó∂Èó¥ÔºåÂçï‰ΩçÊòØÊØ´Áßí„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰∏ÄËà¨Âú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®ÔºåÂú®ÈùûÂçèÁ®ã‰∏≠Ë∞ÉÁî®Áõ∏ÂΩì‰∫é <code>sleep::ms(ms)</code>„ÄÇ</li>
</ul>
<h3 id="cotimeout"><a class="anchor" href="#cotimeout">#</a>co::timeout</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">timeout</span>();
</span></span></code></pre></div><ul>
<li>Ê≠§ÂáΩÊï∞Âà§Êñ≠‰πãÂâçÁöÑ IO Êìç‰ΩúÊòØÂê¶Ë∂ÖÊó∂„ÄÇÁî®Êà∑Âú®Ë∞ÉÁî® <code>co::recv()</code>¬†Á≠âÂ∏¶Ë∂ÖÊó∂Êó∂Èó¥ÁöÑÂáΩÊï∞ÂêéÔºåÂèØ‰ª•Ë∞ÉÁî®Ê≠§ÂáΩÊï∞Âà§Êñ≠ÊòØÂê¶Ë∂ÖÊó∂„ÄÇ</li>
<li><strong>Ê≠§ÂáΩÊï∞ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// print scheduler id and coroutine id every 3 seconds
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">f</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> (<span style="color:#0086b3">true</span>) {
</span></span><span style="display:flex;"><span>        LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;s: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> co<span style="color:#000;font-weight:bold">::</span>scheduler_id() <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34; c: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> co<span style="color:#000;font-weight:bold">::</span>coroutine_id();
</span></span><span style="display:flex;"><span>        co<span style="color:#000;font-weight:bold">::</span>sleep(<span style="color:#099">3000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">main</span>(<span style="color:#458;font-weight:bold">int</span> argc, <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">**</span> argv) {
</span></span><span style="display:flex;"><span>    flag<span style="color:#000;font-weight:bold">::</span>init(argc, argv);
</span></span><span style="display:flex;"><span>    FLG_cout <span style="color:#000;font-weight:bold">=</span> <span style="color:#0086b3">true</span>; <span style="color:#998;font-style:italic">// also log to terminal
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">32</span>; <span style="color:#000;font-weight:bold">++</span>i) go(f);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> (<span style="color:#0086b3">true</span>) sleep<span style="color:#000;font-weight:bold">::</span>sec(<span style="color:#099">1024</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ÂçèÁ®ãÂåñÁöÑ-socket-api"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b%e5%8c%96%e7%9a%84-socket-api">#</a>ÂçèÁ®ãÂåñÁöÑ socket API</h2>
<p>co Êèê‰æõ‰∫ÜÂ∏∏Áî®ÁöÑÂçèÁ®ãÂåñÁöÑ socket APIÔºå‰ª•ÊîØÊåÅÂü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ã„ÄÇ</p>
<p><strong>Â§ßÈÉ®ÂàÜ API ÂΩ¢Âºè‰∏ä‰∏éÂéüÁîüÁöÑ socket API ‰øùÊåÅ‰∏ÄËá¥</strong>ÔºåËøôÊ†∑ÂèØ‰ª•ÂáèËΩªÁî®Êà∑ÁöÑÂ≠¶‰π†Ë¥üÊãÖÔºåÁÜüÊÇâ socket ÁºñÁ®ãÁöÑÁî®Êà∑ÂèØ‰ª•ËΩªÊùæ‰∏äÊâã„ÄÇ</p>
<p>Ëøô‰∫õ API Â§ßÈÉ®ÂàÜÈúÄË¶ÅÂú®ÂçèÁ®ã‰∏≠‰ΩøÁî®ÔºåÂÆÉ‰ª¨Âú® I/O ÈòªÂ°ûÊàñË∞ÉÁî® sleep Á≠âÊìç‰ΩúÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÊåÇËµ∑ÂΩìÂâçÂçèÁ®ãÔºåÂàáÊç¢Âà∞ÂÖ∂‰ªñÁ≠âÂæÖ‰∏≠ÁöÑÂçèÁ®ãËøêË°åÔºåË∞ÉÂ∫¶Á∫øÁ®ãÊú¨Ë∫´Âπ∂‰∏ç‰ºöÈòªÂ°û„ÄÇÂÄüÂä©Ëøô‰∫õ APIÔºåÁî®Êà∑ÂèØ‰ª•<strong>ËΩªÊùæÁöÑÂÆûÁé∞È´òÂπ∂Âèë„ÄÅÈ´òÊÄßËÉΩÁöÑÁΩëÁªúÁ®ãÂ∫è</strong>„ÄÇ</p>
<h3 id="ÊúØËØ≠Á∫¶ÂÆöÂøÖÁúã"><a class="anchor" href="#%e6%9c%af%e8%af%ad%e7%ba%a6%e5%ae%9a%e5%bf%85%e7%9c%8b">#</a>ÊúØËØ≠Á∫¶ÂÆö(ÂøÖÁúã)</h3>
<p><strong>ÈòªÂ°û</strong></p>
<p>Âú®ÊèèËø∞ co ‰∏≠ÁöÑ‰∏Ä‰∫õ socket API Êó∂Ôºå‰ºöÁî®Âà∞ÈòªÂ°û‰∏ÄËØçÔºåÂ¶Ç accept, recvÔºåÊñáÊ°£‰∏≠ËØ¥ÂÆÉ‰ª¨‰ºöÈòªÂ°ûÔºåÊòØÊåáÂΩìÂâçÁöÑÂçèÁ®ã‰ºöÈòªÂ°ûÔºåËÄåÂΩìÂâçÁöÑË∞ÉÂ∫¶Á∫øÁ®ãÂπ∂‰∏ç‰ºöÈòªÂ°û(ÂèØ‰ª•ÂàáÊç¢Âà∞ÂÖ∂‰ªñÂçèÁ®ãËøêË°å)„ÄÇÁî®Êà∑ÁúãÂà∞ÁöÑÊòØÂçèÁ®ãÔºåËÄå‰∏çÊòØË∞ÉÂ∫¶Á∫øÁ®ãÔºåÂõ†Ê≠§‰ªéÁî®Êà∑ÁöÑËßíÂ∫¶ÁúãÔºåÂÆÉ‰ª¨ÊòØÈòªÂ°ûÁöÑ„ÄÇÂÆûÈôÖ‰∏äÔºåËøô‰∫õ API ÂÜÖÈÉ®‰ΩøÁî® <strong>non-blocking socket</strong>ÔºåÂπ∂‰∏ç‰ºöÁúüÁöÑÈòªÂ°ûÔºåÂè™ÊòØÂú® socket ‰∏äÊ≤°ÊúâÊï∞ÊçÆÂèØËØªÊàñËÄÖÊó†Ê≥ïÁ´ãÂç≥ÂÜôÂÖ•Êï∞ÊçÆÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÊåÇËµ∑ÂΩìÂâçËøõË°å I/O Êìç‰ΩúÁöÑÂçèÁ®ãÔºåÂΩì socket Âèò‰∏∫ÂèØËØªÊàñÂèØÂÜôÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ã‰ºöÈáçÊñ∞Âî§Ëµ∑ËØ•ÂçèÁ®ãÔºåÁªßÁª≠ I/O Êìç‰Ωú„ÄÇ</p>
<p><strong>non-blocking socket</strong></p>
<p><strong>co ‰∏≠ÁöÑ socket API ÂøÖÈ°ª‰ΩøÁî® non-blocking socket</strong>ÔºåÂú® windows Âπ≥Âè∞ËøòË¶ÅÊ±Ç socket ÊîØÊåÅ <a href="https://support.microsoft.com/en-us/help/181611/socket-overlapped-i-o-versus-blocking-nonblocking-mode">overlapped I/O</a>Ôºåwin32 API ÂàõÂª∫ÁöÑ socket ÈªòËÆ§ÈÉΩÊîØÊåÅ overlapped I/OÔºåÁî®Êà∑‰∏ÄËà¨‰∏çÈúÄË¶ÅÊãÖÂøÉËøô‰∏™ÈóÆÈ¢ò„ÄÇ‰∏∫‰∫ÜÂèôËø∞Êñπ‰æøÔºåËøôÈáåÁ∫¶ÂÆöÊñáÊ°£‰∏≠ËØ¥Âà∞ non-blocking socket Êó∂ÔºåÂêåÊó∂‰πüË°®Á§∫ÂÆÉÂú® windows ‰∏äÊîØÊåÅ overlapped I/O„ÄÇ</p>
<h3 id="cosocket"><a class="anchor" href="#cosocket">#</a>co::socket</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>sock_t <span style="color:#900;font-weight:bold">socket</span>(<span style="color:#458;font-weight:bold">int</span> domain, <span style="color:#458;font-weight:bold">int</span> type, <span style="color:#458;font-weight:bold">int</span> proto);
</span></span><span style="display:flex;"><span>sock_t <span style="color:#900;font-weight:bold">tcp_socket</span>(<span style="color:#458;font-weight:bold">int</span> domain<span style="color:#000;font-weight:bold">=</span>AF_INET);
</span></span><span style="display:flex;"><span>sock_t <span style="color:#900;font-weight:bold">udp_socket</span>(<span style="color:#458;font-weight:bold">int</span> domain<span style="color:#000;font-weight:bold">=</span>AF_INET);
</span></span></code></pre></div><ul>
<li>ÂàõÂª∫ socket„ÄÇ</li>
<li>Á¨¨ 1 ‰∏™ÂáΩÊï∞ÂΩ¢Âºè‰∏ä‰∏éÂéüÁîü API ÂÆåÂÖ®‰∏ÄÊ†∑ÔºåÂú® linux Á≥ªÁªüÂèØ‰ª•Áî® <code>man socket</code>¬†Êü•ÁúãÂèÇÊï∞ËØ¶ÊÉÖ„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÂáΩÊï∞ÂàõÂª∫‰∏Ä‰∏™ TCP socket„ÄÇ</li>
<li>Á¨¨ 3 ‰∏™ÂáΩÊï∞ÂàõÂª∫‰∏Ä‰∏™ UDP¬†socket„ÄÇ</li>
<li>ÂèÇÊï∞ domain ‰∏ÄËà¨ÊòØ AF_INET Êàñ AF_INET6ÔºåÂâçËÄÖË°®Á§∫ ipv4ÔºåÂêéËÄÖË°®Á§∫ ipv6„ÄÇ</li>
<li><strong>Ëøô‰∫õÂáΩÊï∞ËøîÂõû‰∏Ä‰∏™ non-blocking socket</strong>„ÄÇÂèëÁîüÈîôËØØÊó∂ÔºåËøîÂõûÂÄºÊòØ -1ÔºåÂèØ‰ª•Ë∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="coaccept"><a class="anchor" href="#coaccept">#</a>co::accept</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>sock_t <span style="color:#900;font-weight:bold">accept</span>(sock_t fd, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> addr, <span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">*</span> addrlen);
</span></span></code></pre></div><ul>
<li>Âú®ÊåáÂÆö socket ‰∏äÊé•Êî∂ÂÆ¢Êà∑Á´ØËøûÊé•ÔºåÂèÇÊï∞ fd ÊòØ‰πãÂâçË∞ÉÁî® listen() ÁõëÂê¨ÁöÑ non-blocking socketÔºåÂèÇÊï∞ addr ‰∏é addrlen Áî®‰∫éÊé•Êî∂ÂÆ¢Êà∑Á´ØÁöÑÂú∞ÂùÄ‰ø°ÊÅØÔºå<code>*addrlen</code>¬†ÁöÑÂàùÂßãÂÄºÊòØ addr ÊâÄÊåáÂêë buffer ÁöÑÈïøÂ∫¶„ÄÇÂ¶ÇÊûúÁî®Êà∑‰∏çÈúÄË¶ÅÂÆ¢Êà∑Á´ØÂú∞ÂùÄ‰ø°ÊÅØÔºåÂèØ‰ª•Â∞Ü addr ‰∏é addrlen ËÆæÁΩÆ‰∏∫ NULL„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ÊúâÊñ∞ÁöÑËøûÊé•ËøõÊù•ÔºåÊàñËÄÖÂèëÁîüÈîôËØØ„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂<strong>ËøîÂõû‰∏Ä‰∏™ non-blocking socket</strong>ÔºåÂèëÁîüÈîôËØØÊó∂ËøîÂõû -1ÔºåÂèØ‰ª•Ë∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="cobind"><a class="anchor" href="#cobind">#</a>co::bind</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">bind</span>(sock_t fd, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> addr, <span style="color:#458;font-weight:bold">int</span> addrlen);
</span></span></code></pre></div><ul>
<li>Áªô socket ÁªëÂÆö ip Âú∞ÂùÄÔºåÂèÇÊï∞ addr ‰∏é addrlen ÊòØÂú∞ÂùÄ‰ø°ÊÅØÔºå‰∏éÂéüÁîü API Áõ∏Âêå„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû 0ÔºåÂê¶ÂàôËøîÂõû -1ÔºåÂèØ‰ª•Ë∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="coclose"><a class="anchor" href="#coclose">#</a>co::close</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">close</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>);
</span></span></code></pre></div><ul>
<li>ÂÖ≥Èó≠ socket„ÄÇ</li>
<li>Âú® 2.0.0 Âèä‰πãÂâçÁöÑÁâàÊú¨‰∏≠ÔºåÊ≠§ÂáΩÊï∞ÂøÖÈ°ªÂú®ËøõË°å I/O Êìç‰ΩúÁöÑÁ∫øÁ®ã‰∏≠Ë∞ÉÁî®„ÄÇ‰ªé 2.0.1 ÁâàÊú¨ÂºÄÂßãÔºåÊ≠§ÂáΩÊï∞ÂèØ‰ª•Âú®ÂçèÁ®ãÊàñÈùûÂçèÁ®ã‰∏≠Ë∞ÉÁî®„ÄÇ</li>
<li>ÂèÇÊï∞ ms &gt; 0 Êó∂ÔºåÂÖàË∞ÉÁî® <code>co::sleep(ms)</code> Â∞ÜÂΩìÂâçÂçèÁ®ãÊåÇËµ∑‰∏ÄÊÆµÊó∂Èó¥ÔºåÂÜçÂÖ≥Èó≠ socket„ÄÇ‰∏ÄËà¨Âè™Âú® server Á´ØËÆæÁΩÆ &gt; 0 ÁöÑÂèÇÊï∞ÔºåÂèØ‰ª•Âú®‰∏ÄÂÆöÁ®ãÂ∫¶‰∏äÁºìËß£ÈùûÊ≥ïÁöÑÁΩëÁªúÊîªÂáª„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÂÜÖÈÉ®Â∑≤ÁªèÂ§ÑÁêÜ‰∫Ü <code>EINTR</code> ‰ø°Âè∑ÔºåÁî®Êà∑Êó†ÈúÄËÄÉËôë„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû 0ÔºåÂê¶ÂàôËøîÂõû -1ÔºåÂèØ‰ª•Ë∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="coconnect"><a class="anchor" href="#coconnect">#</a>co::connect</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">connect</span>(sock_t fd, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> addr, <span style="color:#458;font-weight:bold">int</span> addrlen, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>Âú®ÊåáÂÆö socket ‰∏äÂàõÂª∫Âà∞ÊåáÂÆöÂú∞ÂùÄÁöÑËøûÊé•ÔºåÂèÇÊï∞ fd ÂøÖÈ°ªÊòØ non-blocking ÁöÑÔºåÂèÇÊï∞ addr ‰∏é addrlen ÊòØÂú∞ÂùÄ‰ø°ÊÅØÔºåÂèÇÊï∞ ms ÊòØË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´ÁßíÔºåÈªòËÆ§‰∏∫ -1ÔºåÊ∞∏‰∏çË∂ÖÊó∂„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ËøûÊé•ÂÆåÊàêÔºåÊàñËÄÖË∂ÖÊó∂„ÄÅÂèëÁîüÈîôËØØ„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû 0ÔºåË∂ÖÊó∂ÊàñÂèëÁîüÈîôËØØËøîÂõû -1ÔºåÁî®Êà∑ÂèØ‰ª•Ë∞ÉÁî® co::timeout()¬†Âà§Êñ≠ÊòØÂê¶Ë∂ÖÊó∂ÔºåË∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="colisten"><a class="anchor" href="#colisten">#</a>co::listen</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">listen</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> backlog<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1024</span>);
</span></span></code></pre></div><ul>
<li>ÁõëÂê¨ÊåáÂÆöÁöÑ socketÔºåÂèÇÊï∞ fd ÊòØÂ∑≤ÁªèË∞ÉÁî® bind() ÁªëÂÆö ip ÂèäÁ´ØÂè£ÁöÑ socket„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû 0ÔºåÂê¶ÂàôËøîÂõû -1ÔºåÂèØ‰ª•Ë∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="corecv"><a class="anchor" href="#corecv">#</a>co::recv</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">recv</span>(sock_t fd, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>Âú®ÊåáÂÆö socket ‰∏äÊé•Êî∂Êï∞ÊçÆÔºåÂèÇÊï∞ fd ÂøÖÈ°ªÊòØ non-blocking ÁöÑÔºåÂèÇÊï∞ buf ÊòØÁî®‰∫éÊé•Êî∂Êï∞ÊçÆÁöÑ bufferÔºåÂèÇÊï∞ n ÊòØ buffer ÈïøÂ∫¶ÔºåÂèÇÊï∞ ms ÊòØË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´ÁßíÔºåÈªòËÆ§‰∏∫ -1ÔºåÊ∞∏‰∏çË∂ÖÊó∂„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>Âú® Windows Âπ≥Âè∞ÔºåÊ≠§ÂáΩÊï∞Âè™ÈÄÇÁî®‰∫é TCP Á≠â stream Á±ªÂûãÁöÑ socket„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ÊúâÊï∞ÊçÆËøõÊù•ÔºåÊàñËÄÖË∂ÖÊó∂„ÄÅÂèëÁîüÈîôËØØ„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõûÊé•Êî∂ÁöÑÊï∞ÊçÆÈïøÂ∫¶(ÂèØËÉΩÂ∞è‰∫é n)ÔºåÂØπÁ´ØÂÖ≥Èó≠ËøûÊé•Êó∂ËøîÂõû 0ÔºåË∂ÖÊó∂ÊàñÂèëÁîüÈîôËØØËøîÂõû -1ÔºåÁî®Êà∑ÂèØ‰ª•Ë∞ÉÁî® co::timeout()¬†Âà§Êñ≠ÊòØÂê¶Ë∂ÖÊó∂ÔºåË∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="corecvn"><a class="anchor" href="#corecvn">#</a>co::recvn</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">recvn</span>(sock_t fd, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>Âú®ÊåáÂÆö socket ‰∏äÊé•Êî∂ÊåáÂÆöÈïøÂ∫¶ÁöÑÊï∞ÊçÆÔºåÂèÇÊï∞ fd ÂøÖÈ°ªÊòØ non-blocking ÁöÑÔºåÂèÇÊï∞ buf ÊòØÁî®‰∫éÊé•Êî∂Êï∞ÊçÆÁöÑ bufferÔºåÂèÇÊï∞ n ÊòØË¶ÅÊé•Êî∂Êï∞ÊçÆÁöÑÈïøÂ∫¶ÔºåÂèÇÊï∞ ms ÊòØË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´ÁßíÔºåÈªòËÆ§‰∏∫ -1ÔºåÊ∞∏‰∏çË∂ÖÊó∂„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ n Â≠óËäÇÁöÑÊï∞ÊçÆÂÖ®ÈÉ®Êé•Êî∂ÂÆåÔºåÊàñËÄÖË∂ÖÊó∂„ÄÅÂèëÁîüÈîôËØØ„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû nÔºåÂØπÁ´ØÂÖ≥Èó≠ËøûÊé•Êó∂ËøîÂõû 0ÔºåË∂ÖÊó∂ÊàñÂèëÁîüÈîôËØØËøîÂõû -1ÔºåÁî®Êà∑ÂèØ‰ª•Ë∞ÉÁî® co::timeout()¬†Ê£ÄÊü•ÊòØÂê¶Ë∂ÖÊó∂ÔºåË∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="corecvfrom"><a class="anchor" href="#corecvfrom">#</a>co::recvfrom</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">recvfrom</span>(sock_t fd, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> src_addr, <span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">*</span> addrlen, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>‰∏é recv() Á±ª‰ººÔºåÂè™ÊòØÂèØ‰ª•Áî®ÂèÇÊï∞ src_addr ‰∏é addrlen Êé•Êî∂Ê∫êÂú∞ÂùÄ‰ø°ÊÅØÔºå<code>*addrlen</code>¬†ÁöÑÂàùÂßãÂÄºÊòØ src_addr ÊâÄÊåáÂêë buffer ÁöÑÈïøÂ∫¶ÔºåÂ¶ÇÊûúÁî®Êà∑‰∏çÈúÄË¶ÅÊ∫êÂú∞ÂùÄ‰ø°ÊÅØÔºåÂèØ‰ª•Â∞Ü addr ‰∏é addrlen ËÆæÁΩÆ‰∏∫ NULL„ÄÇ</li>
<li>‰∏ÄËà¨<strong>Âª∫ËÆÆÂè™Áî®Ê≠§ÂáΩÊï∞Êé•Êî∂ UDP Êï∞ÊçÆ</strong>ÔºåÂØπ‰∫é TCP Êï∞ÊçÆÔºåÂª∫ËÆÆÁî® recv() Êàñ recvn()„ÄÇ</li>
</ul>
<h3 id="cosend"><a class="anchor" href="#cosend">#</a>co::send</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">send</span>(sock_t fd, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>ÂêëÊåáÂÆö socket ‰∏äÂèëÈÄÅÊï∞ÊçÆÔºåÂèÇÊï∞ fd ÂøÖÈ°ªÊòØ non-blocking ÁöÑÔºåÂèÇÊï∞ buf ‰∏é n ÊòØË¶ÅÂèëÈÄÅÁöÑÊï∞ÊçÆÂèäÈïøÂ∫¶ÔºåÂèÇÊï∞ ms ÊòØË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´ÁßíÔºåÈªòËÆ§‰∏∫ -1ÔºåÊ∞∏‰∏çË∂ÖÊó∂„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>Âú® Windows Âπ≥Âè∞ÔºåÊ≠§ÂáΩÊï∞Âè™ÈÄÇÁî®‰∫é TCP Á≠â stream Á±ªÂûãÁöÑ socket„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ n Â≠óËäÇÁöÑÊï∞ÊçÆÂÖ®ÈÉ®ÂèëÈÄÅÂÆåÔºåÊàñËÄÖË∂ÖÊó∂„ÄÅÂèëÁîüÈîôËØØ„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû nÔºåË∂ÖÊó∂ÊàñÂèëÁîüÈîôËØØËøîÂõû -1ÔºåÁî®Êà∑ÂèØ‰ª•Ë∞ÉÁî® co::timeout()¬†Ê£ÄÊü•ÊòØÂê¶Ë∂ÖÊó∂ÔºåË∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="cosendto"><a class="anchor" href="#cosendto">#</a>co::sendto</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">sendto</span>(sock_t fd, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> dst_addr, <span style="color:#458;font-weight:bold">int</span> addrlen, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>ÂêëÊåáÂÆöÁöÑÂú∞ÂùÄÂèëÈÄÅÊï∞ÊçÆÔºåÂΩì dst_addr ‰∏∫ NULLÔºåaddrlen ‰∏∫ 0 Êó∂Ôºå‰∏é send() Á≠â‰ª∑„ÄÇ</li>
<li>‰∏ÄËà¨<strong>Âª∫ËÆÆÂè™Áî®Ê≠§ÂáΩÊï∞ÂèëÈÄÅ UDP Êï∞ÊçÆ</strong>ÔºåÂØπ‰∫é TCP Êï∞ÊçÆÔºåÂª∫ËÆÆÁî® send()„ÄÇ</li>
<li>fd ÊòØ UDP socket Êó∂Ôºån ÊúÄÂ§ßÊòØ 65507„ÄÇ</li>
</ul>
<h3 id="coshutdown"><a class="anchor" href="#coshutdown">#</a>co::shutdown</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">shutdown</span>(sock_t fd, <span style="color:#458;font-weight:bold">char</span> c<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;b&#39;</span>);
</span></span></code></pre></div><ul>
<li>Ê≠§ÂáΩÊï∞‰∏ÄËà¨Áî®‰∫éÂçäÂÖ≥Èó≠ socketÔºåÂèÇÊï∞ c ‰∏∫ <code>'r'</code> Êó∂Ë°®Á§∫ÂÖ≥Èó≠ËØªÔºå‰∏∫ <code>'w'</code> Êó∂Ë°®Á§∫ÂÖ≥Èó≠ÂÜôÔºåÈªòËÆ§‰∏∫ <code>'b'</code>ÔºåÂÖ≥Èó≠ËØª‰∏éÂÜô„ÄÇ</li>
<li>‰∏ÄËà¨Âª∫ËÆÆÂú®ËøõË°å IO Êìç‰ΩúÁöÑÁ∫øÁ®ã‰∏≠Ë∞ÉÁî®Ê≠§ÂáΩÊï∞„ÄÇ</li>
<li>Ê≠§ÂáΩÊï∞ÊàêÂäüÊó∂ËøîÂõû 0ÔºåÂê¶ÂàôËøîÂõû -1ÔºåÂèØ‰ª•Ë∞ÉÁî® <code>co::error()</code>, <code>co::strerror()</code> Ëé∑ÂèñÈîôËØØ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<h3 id="coerror"><a class="anchor" href="#coerror">#</a>co::error</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">&amp;</span> error();
</span></span></code></pre></div><ul>
<li>ËøîÂõûÂΩìÂâçÁöÑÈîôËØØÁ†Å„ÄÇ</li>
<li>CO ‰∏≠ÁöÑ socket API ËøîÂõû -1 Êó∂ÔºåÂèØ‰ª•Ë∞ÉÁî®Ê≠§ÂáΩÊï∞Ëé∑ÂèñÈîôËØØÁ†Å„ÄÇ</li>
</ul>
<h3 id="costrerror"><a class="anchor" href="#costrerror">#</a>co::strerror</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">strerror</span>(<span style="color:#458;font-weight:bold">int</span> err);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">strerror</span>();
</span></span></code></pre></div><ul>
<li>Ëé∑ÂèñÈîôËØØÁ†ÅÂØπÂ∫îÁöÑÊèèËø∞‰ø°ÊÅØ„ÄÇÊ≠§ÂáΩÊï∞ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÁâàÊú¨Ëé∑ÂèñÂΩìÂâçÈîôËØØÁöÑÊèèËø∞‰ø°ÊÅØÔºåÁ≠â‰ª∑‰∫é <code>strerror(co::error())</code>„ÄÇ</li>
</ul>
<h3 id="heading"><a class="anchor" href="#heading">#</a>‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</h3>
<h3 id="cogetsockopt"><a class="anchor" href="#cogetsockopt">#</a>co::getsockopt</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getsockopt</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> lv, <span style="color:#458;font-weight:bold">int</span> opt, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> optval, <span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">*</span> optlen);
</span></span></code></pre></div><ul>
<li>Ëé∑Âèñ socket option ‰ø°ÊÅØÔºå‰∏éÂéüÁîü API ÂÆåÂÖ®‰∏ÄÊ†∑Ôºåman getsockopt ÁúãËØ¶ÊÉÖ„ÄÇ</li>
</ul>
<h3 id="cosetsockopt"><a class="anchor" href="#cosetsockopt">#</a>co::setsockopt</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">setsockopt</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> lv, <span style="color:#458;font-weight:bold">int</span> opt, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> optval, <span style="color:#458;font-weight:bold">int</span> optlen);
</span></span></code></pre></div><ul>
<li>ËÆæÁΩÆ socket option ‰ø°ÊÅØÔºå‰∏éÂéüÁîü API ÂÆåÂÖ®‰∏ÄÊ†∑Ôºåman setsockopt ÁúãËØ¶ÊÉÖ„ÄÇ</li>
</ul>
<h3 id="coset_nonblock"><a class="anchor" href="#coset_nonblock">#</a>co::set_nonblock</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_nonblock</span>(sock_t fd);
</span></span></code></pre></div><ul>
<li>Áªô socket ËÆæÁΩÆ O_NONBLOCK ÈÄâÈ°π„ÄÇ</li>
</ul>
<h3 id="coset_reuseaddr"><a class="anchor" href="#coset_reuseaddr">#</a>co::set_reuseaddr</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_reuseaddr</span>(sock_t fd);
</span></span></code></pre></div><ul>
<li>Áªô socket ËÆæÁΩÆ¬†SO_REUSEADDR ÈÄâÈ°πÔºå‰∏ÄËà¨ server Á´ØÁöÑ listening socket ÈúÄË¶ÅËÆæÁΩÆËøô‰∏™ÈÄâÈ°πÔºåÈò≤Ê≠¢ server ÈáçÂêØÂêé bind Â§±Ë¥•„ÄÇ</li>
</ul>
<h3 id="coset_recv_buffer_size"><a class="anchor" href="#coset_recv_buffer_size">#</a>co::set_recv_buffer_size</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_recv_buffer_size</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> n);
</span></span></code></pre></div><ul>
<li>ËÆæÁΩÆ socket ÁöÑÊé•Êî∂ÁºìÂÜ≤Âå∫Â§ßÂ∞èÔºåÂøÖÈ°ªÂú® socket ËøûÊé•ÂâçË∞ÉÁî®Ê≠§ÂáΩÊï∞„ÄÇ</li>
</ul>
<h3 id="coset_send_buffer_size"><a class="anchor" href="#coset_send_buffer_size">#</a>co::set_send_buffer_size</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_send_buffer_size</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> n);
</span></span></code></pre></div><ul>
<li>ËÆæÁΩÆ socket ÁöÑÂèëÈÄÅÁºìÂÜ≤Âå∫Â§ßÂ∞èÔºåÂøÖÈ°ªÂú® socket ËøûÊé•ÂâçË∞ÉÁî®Ê≠§ÂáΩÊï∞„ÄÇ</li>
</ul>
<h3 id="coset_tcp_keepalive"><a class="anchor" href="#coset_tcp_keepalive">#</a>co::set_tcp_keepalive</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_tcp_keepalive</span>(sock_t fd);
</span></span></code></pre></div><ul>
<li>Áªô socket ËÆæÁΩÆ SO_KEEPALIVE ÈÄâÈ°π„ÄÇ</li>
</ul>
<h3 id="coset_tcp_nodelay"><a class="anchor" href="#coset_tcp_nodelay">#</a>co::set_tcp_nodelay</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">set_tcp_nodelay</span>(sock_t fd);
</span></span></code></pre></div><ul>
<li>Áªô socket ËÆæÁΩÆ TCP_NODELAY ÈÄâÈ°π„ÄÇ</li>
</ul>
<h3 id="coreset_tcp_socket"><a class="anchor" href="#coreset_tcp_socket">#</a>co::reset_tcp_socket</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">reset_tcp_socket</span>(sock_t fd, <span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>);
</span></span></code></pre></div><ul>
<li>ÈáçÁΩÆ TCP ËøûÊé•Ôºå‰∏é co::close() Á±ª‰ººÔºå‰ΩÜ‰∏ªÂä®Ë∞ÉÁî®Êñπ‰∏ç‰ºöËøõÂÖ• TIME_WAIT Áä∂ÊÄÅ„ÄÇ</li>
<li>‰∏ÄËà¨Âè™Êúâ server Á´Ø‰ºöË∞ÉÁî®Ê≠§ÂáΩÊï∞ÔºåÁî®‰∫é‰∏ªÂä®ÂÖ≥Èó≠ÂÆ¢Êà∑Á´ØËøûÊé•ÔºåÂêåÊó∂ÈÅøÂÖçËøõÂÖ• TIME_WAIT Áä∂ÊÄÅ„ÄÇ</li>
</ul>
<h3 id="heading-1"><a class="anchor" href="#heading-1">#</a>‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</h3>
<h3 id="coinit_ip_addr"><a class="anchor" href="#coinit_ip_addr">#</a>co::init_ip_addr</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">init_ip_addr</span>(<span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in</span><span style="color:#000;font-weight:bold">*</span> addr, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> ip, <span style="color:#458;font-weight:bold">int</span> port);
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">init_ip_addr</span>(<span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in6</span><span style="color:#000;font-weight:bold">*</span> addr, <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> ip, <span style="color:#458;font-weight:bold">int</span> port);
</span></span></code></pre></div><ul>
<li>
<p>Áî® ip Âèä port ÂàùÂßãÂåñ sockaddr ÁªìÊûÑ„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 1 ‰∏™ÁâàÊú¨Áî®‰∫é ipv4 Âú∞ÂùÄÔºåÁ¨¨ 2 ‰∏™ÁâàÊú¨Áî®‰∫é ipv6 Âú∞ÂùÄ„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">union</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in</span>  v4;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in6</span> v6;
</span></span><span style="display:flex;"><span>} addr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>init_ip_addr(<span style="color:#000;font-weight:bold">&amp;</span>addr.v4, <span style="color:#d14">&#34;127.0.0.1&#34;</span>, <span style="color:#099">7777</span>);
</span></span><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>init_ip_addr(<span style="color:#000;font-weight:bold">&amp;</span>addr.v6, <span style="color:#d14">&#34;::&#34;</span>, <span style="color:#099">7777</span>);
</span></span></code></pre></div><h3 id="coip_str"><a class="anchor" href="#coip_str">#</a>co::ip_str</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>fastring <span style="color:#900;font-weight:bold">ip_str</span>(<span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in</span><span style="color:#000;font-weight:bold">*</span> addr);
</span></span><span style="display:flex;"><span>fastring <span style="color:#900;font-weight:bold">ip_str</span>(<span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in6</span><span style="color:#000;font-weight:bold">*</span> addr);
</span></span></code></pre></div><ul>
<li>
<p>‰ªé sockaddr ÁªìÊûÑ‰∏≠Ëé∑Âèñ ip Â≠óÁ¨¶‰∏≤„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 1 ‰∏™ÁâàÊú¨Áî®‰∫é ipv4 Âú∞ÂùÄÔºåÁ¨¨ 2 ‰∏™ÁâàÊú¨Áî®‰∫é ipv6 Âú∞ÂùÄ„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in</span> addr;
</span></span><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>init_ip_addr(<span style="color:#000;font-weight:bold">&amp;</span>addr, <span style="color:#d14">&#34;127.0.0.1&#34;</span>, <span style="color:#099">7777</span>);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">auto</span> s <span style="color:#000;font-weight:bold">=</span> co<span style="color:#000;font-weight:bold">::</span>ip_str(<span style="color:#000;font-weight:bold">&amp;</span>addr);  <span style="color:#998;font-style:italic">// s -&gt; &#34;127.0.0.1&#34;
</span></span></span></code></pre></div><h3 id="coto_string"><a class="anchor" href="#coto_string">#</a>co::to_string</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>fastring <span style="color:#900;font-weight:bold">to_string</span>(<span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in</span><span style="color:#000;font-weight:bold">*</span> addr);
</span></span><span style="display:flex;"><span>fastring <span style="color:#900;font-weight:bold">to_string</span>(<span style="color:#000;font-weight:bold">const</span> <span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in6</span><span style="color:#000;font-weight:bold">*</span> addr);
</span></span><span style="display:flex;"><span>fastring <span style="color:#900;font-weight:bold">to_string</span>(<span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> addr, <span style="color:#458;font-weight:bold">int</span> addrlen);
</span></span></code></pre></div><ul>
<li>
<p>Â∞Ü sockaddr Âú∞ÂùÄËΩ¨Êç¢Êàê <code>&quot;ip:port&quot;</code> ÂΩ¢ÂºèÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 1 ‰∏™ÁâàÊú¨Áî®‰∫é ipv4 Âú∞ÂùÄÔºåÁ¨¨ 2 ‰∏™ÁâàÊú¨Áî®‰∫é ipv6 Âú∞ÂùÄ„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 3 ‰∏™ÁâàÊú¨Ê†πÊçÆ addrlen ÈÄâÊã©Ë∞ÉÁî®ÁâàÊú¨ 1 ÊàñÁâàÊú¨ 2„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">struct</span> <span style="color:#458;font-weight:bold">sockaddr_in</span> addr;
</span></span><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>init_ip_addr(<span style="color:#000;font-weight:bold">&amp;</span>addr, <span style="color:#d14">&#34;127.0.0.1&#34;</span>, <span style="color:#099">7777</span>);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">auto</span> s <span style="color:#000;font-weight:bold">=</span> co<span style="color:#000;font-weight:bold">::</span>to_string(<span style="color:#000;font-weight:bold">&amp;</span>addr);  <span style="color:#998;font-style:italic">// s -&gt; &#34;127.0.0.1:7777&#34;
</span></span></span></code></pre></div><h3 id="copeer"><a class="anchor" href="#copeer">#</a>co::peer</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>fastring <span style="color:#900;font-weight:bold">peer</span>(sock_t fd);
</span></span></code></pre></div><ul>
<li>Ëé∑Âèñ peer Á´ØÁöÑÂú∞ÂùÄ‰ø°ÊÅØÔºåËøîÂõûÂÄºÊòØ <code>&quot;ip:port&quot;</code> ÂΩ¢ÂºèÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇ</li>
</ul>
<h2 id="channelcochan"><a class="anchor" href="#channelcochan">#</a>channel(co::Chan)</h2>
<p><code>co::Chan</code> ÊòØ‰∏Ä‰∏™Ê®°ÊùøÁ±ªÔºåÂÆÉÁ±ª‰ºº‰∫é golang ‰∏≠ÁöÑ channelÔºåÁî®‰∫éÂú®ÂçèÁ®ã‰πãÈó¥‰º†ÈÄíÊï∞ÊçÆ„ÄÇ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span> <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Chan</span>;
</span></span></code></pre></div><ul>
<li><code>co::Chan</code> ÂÜÖÈÉ®Âü∫‰∫éÂÜÖÂ≠òÊã∑Ë¥ùÂÆûÁé∞ÔºåÊ®°ÊùøÂèÇÊï∞ T ÂèØ‰ª•ÊòØÂÜÖÁΩÆÁ±ªÂûã„ÄÅÊåáÈíàÁ±ªÂûãÔºåÊàñËÄÖ<strong>Êã∑Ë¥ùÊìç‰ΩúÂÖ∑ÊúâÁÆÄÂçïÁöÑÂÜÖÂ≠òÊã∑Ë¥ùËØ≠‰πâÁöÑÁªìÊûÑ‰ΩìÁ±ªÂûã</strong>„ÄÇÁÆÄËÄåË®Ä‰πãÔºåT ÂøÖÈ°ªÊª°Ë∂≥‰∏ãËø∞Êù°‰ª∂ÔºöÂØπ‰∫é T Á±ªÂûãÁöÑ‰∏§‰∏™ÂèòÈáèÊàñÂØπË±° a ‰∏é b, <strong><code>a = b</code> Á≠â‰ª∑‰∫é <code>memcpy(&amp;a, &amp;b, sizeof(T))</code></strong>„ÄÇ</li>
<li>ÂÉè <code>std::string</code> Êàñ STL ‰∏≠ÁöÑÂÆπÂô®Á±ªÂûãÔºåÊã∑Ë¥ùÊìç‰Ωú‰∏çÊòØÁÆÄÂçïÁöÑÂÜÖÂ≠òÊã∑Ë¥ùÔºåÂõ†Ê≠§‰∏çËÉΩÁõ¥Êé•Âú® channel ‰∏≠‰º†ÈÄí„ÄÇ</li>
</ul>
<h3 id="chanchan"><a class="anchor" href="#chanchan">#</a>Chan::Chan</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#900;font-weight:bold">Chan</span>(uint32 cap<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>, uint32 ms<span style="color:#000;font-weight:bold">=</span>(uint32)<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);
</span></span><span style="display:flex;"><span>Chan(Chan<span style="color:#000;font-weight:bold">&amp;&amp;</span> c);
</span></span><span style="display:flex;"><span>Chan(<span style="color:#000;font-weight:bold">const</span> Chan<span style="color:#000;font-weight:bold">&amp;</span> c);
</span></span></code></pre></div><ul>
<li>Á¨¨ 1 ‰∏™ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ÔºåÂèÇÊï∞ cap ÊòØÂÜÖÈÉ®ÈòüÂàóÁöÑÊúÄÂ§ßÂÆπÈáèÔºåÈªòËÆ§ÊòØ 1ÔºåÂèÇÊï∞ ms ÊòØËØªÂÜôÊìç‰ΩúÁöÑË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´ÁßíÔºåÈªòËÆ§‰∏∫ -1ÔºåÊ∞∏‰∏çË∂ÖÊó∂„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÊòØ move ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂèØ‰ª•Â∞Ü <code>co::Chan</code> ÊîæÂÖ• STL ÂÆπÂô®‰∏≠„ÄÇ</li>
<li>Á¨¨ 3 ‰∏™ÊòØÊã∑Ë¥ùÊûÑÈÄ†ÂáΩÊï∞Ôºå‰ªÖÂ∞ÜÂÜÖÈÉ®ÂºïÁî®ËÆ°Êï∞Âä† 1„ÄÇ</li>
</ul>
<h3 id="operator"><a class="anchor" href="#operator">#</a>operator&laquo;</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span> <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> T<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">&lt;&lt;</span>(<span style="color:#000;font-weight:bold">const</span> T<span style="color:#000;font-weight:bold">&amp;</span> x) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>ÂÜôÂÖ•Êìç‰ΩúÔºåÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠ËøõË°å„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ï‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ÂÜôÂÖ•Êìç‰ΩúÂÆåÊàêÊàñË∂ÖÊó∂„ÄÇ</li>
<li>ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ËÆæÁΩÆ‰∫ÜË∂ÖÊó∂Êó∂Èó¥Êó∂ÔºåÂèØ‰ª•Áî® <code>co::timeout()</code> Âà§Êñ≠ÊòØÂê¶Ë∂ÖÊó∂„ÄÇ</li>
</ul>
<h3 id="operator-1"><a class="anchor" href="#operator-1">#</a>operator&raquo;</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span> <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> T<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">&gt;&gt;</span>(T<span style="color:#000;font-weight:bold">&amp;</span> x) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>ËØªÂèñÊìç‰ΩúÔºåÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠ËøõË°å„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ï‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ËØªÂèñÊìç‰ΩúÂÆåÊàêÊàñË∂ÖÊó∂„ÄÇ</li>
<li>ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ËÆæÁΩÆ‰∫ÜË∂ÖÊó∂Êó∂Èó¥Êó∂ÔºåÂèØ‰ª•Áî® <code>co::timeout()</code> Âà§Êñ≠ÊòØÂê¶Ë∂ÖÊó∂„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã-1"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b-1">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;co/co.h&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">f</span>() {
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>Chan<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">&gt;</span> ch;
</span></span><span style="display:flex;"><span>    go([ch]() { ch <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#099">7</span>; });
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> v <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>    ch <span style="color:#000;font-weight:bold">&gt;&gt;</span> v;
</span></span><span style="display:flex;"><span>    LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;v: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> v;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">g</span>() {
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>Chan<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">&gt;</span> ch(<span style="color:#099">32</span>, <span style="color:#099">500</span>);
</span></span><span style="display:flex;"><span>    go([ch]() {
</span></span><span style="display:flex;"><span>        ch <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#099">7</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (co<span style="color:#000;font-weight:bold">::</span>timeout()) LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;write to channel timeout..&#34;</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> v <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>    ch <span style="color:#000;font-weight:bold">&gt;&gt;</span> v;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">!</span>co<span style="color:#000;font-weight:bold">::</span>timeout()) LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;v: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> v;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DEF_main(argc, argv) {
</span></span><span style="display:flex;"><span>    f();
</span></span><span style="display:flex;"><span>    g();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>‰∏äËø∞‰ª£Á†Å‰∏≠ÁöÑ channel ÂØπË±°Âú®Ê†à‰∏äÔºåËÄå CO ÈááÁî®ÁöÑÊòØÂÖ±‰∫´Ê†àÂÆûÁé∞ÊñπÂºèÔºå‰∏Ä‰∏™ÂçèÁ®ãÊ†à‰∏äÁöÑÊï∞ÊçÆÂèØËÉΩË¢´ÂÖ∂‰ªñÂçèÁ®ãË¶ÜÁõñÔºå<strong>ÂçèÁ®ãÈó¥‰∏ÄËà¨‰∏çËÉΩÁõ¥Êé•ÈÄöËøáÊ†à‰∏äÁöÑÊï∞ÊçÆÈÄö‰ø°</strong>ÔºåÂõ†Ê≠§‰ª£Á†Å‰∏≠ÁöÑ lambda ÈááÁî®‰∫Ü<strong>ÊåâÂÄºÊçïËé∑</strong>ÁöÑÊñπÂºèÔºåÂ∞Ü channel Êã∑Ë¥ù‰∫Ü‰∏Ä‰ªΩÔºå‰º†ÈÄíÂà∞Êñ∞Âª∫ÁöÑÂçèÁ®ã‰∏≠„ÄÇchannel ÁöÑÊã∑Ë¥ùÊìç‰ΩúÂè™ÊòØÂ∞ÜÂÜÖÈÉ®ÂºïÁî®ËÆ°Êï∞Âä† 1ÔºåÂá†‰πé‰∏ç‰ºöÂØπÊÄßËÉΩÈÄ†ÊàêÂΩ±Âìç„ÄÇ</p>
<h2 id="ÂçèÁ®ãÂêåÊ≠•‰∫ã‰ª∂coevent"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b%e5%90%8c%e6%ad%a5%e4%ba%8b%e4%bb%b6coevent">#</a>ÂçèÁ®ãÂêåÊ≠•‰∫ã‰ª∂(co::Event)</h2>
<p><code>co::Event</code>¬†ÊòØÂçèÁ®ãÈó¥ÁöÑ‰∏ÄÁßçÂêåÊ≠•Êú∫Âà∂ÔºåÂÆÉ‰∏éÁ∫øÁ®ã‰∏≠ÁöÑ <code>SyncEvent</code>¬†Á±ª‰ºº„ÄÇ‰ªé co 2.0.1 ÁâàÊú¨ÂºÄÂßãÔºåco::Event ÂèØ‰ª•Âú®Á∫øÁ®ã„ÄÅÂçèÁ®ãÁéØÂ¢É‰∏≠Ê∑∑Áî®„ÄÇ</p>
<h3 id="eventevent"><a class="anchor" href="#eventevent">#</a>Event::Event</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Event();
</span></span><span style="display:flex;"><span>Event(Event<span style="color:#000;font-weight:bold">&amp;&amp;</span> e);
</span></span><span style="display:flex;"><span>Event(<span style="color:#000;font-weight:bold">const</span> Event<span style="color:#000;font-weight:bold">&amp;</span> e);
</span></span></code></pre></div><ul>
<li>Á¨¨ 1 ‰∏™ÊòØÈªòËÆ§ÊûÑÈÄ†ÂáΩÊï∞„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÊòØ move ÊûÑÈÄ†ÂáΩÊï∞ÔºåÊîØÊåÅÂ∞Ü co::Event ÊîæÂÖ• STL ÂÆπÂô®‰∏≠„ÄÇ</li>
<li>Á¨¨ 3 ‰∏™ÊòØÊã∑Ë¥ùÊûÑÈÄ†ÂáΩÊï∞Ôºå‰ªÖÂ∞ÜÂÜÖÈÉ®ÂºïÁî®ËÆ°Êï∞Âä† 1„ÄÇ</li>
</ul>
<h3 id="eventsignal"><a class="anchor" href="#eventsignal">#</a>Event::signal</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">signal</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>‰∫ßÁîüÂêåÊ≠•‰ø°Âè∑Ôºåco::Event ÂèòÊàêÂêåÊ≠•Áä∂ÊÄÅÔºåÊâÄÊúâ waiting Áä∂ÊÄÅÁöÑÂçèÁ®ã‰ºöË¢´Âî§ÈÜí„ÄÇ</li>
<li>Ëã• co::Event ÂΩìÂâçÂπ∂Ê≤°Êúâ waiting Áä∂ÊÄÅÁöÑÂçèÁ®ãÔºåÂàô‰∏ã‰∏Ä‰∏™Ë∞ÉÁî® wait() ÊñπÊ≥ïÁöÑÂçèÁ®ã‰ºöÁ´ãÂç≥ËøîÂõû„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®„ÄÇ</li>
</ul>
<h3 id="eventwait"><a class="anchor" href="#eventwait">#</a>Event::wait</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">wait</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">wait</span>(uint32 ms) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Á≠âÂæÖÂêåÊ≠•‰ø°Âè∑ÔºåËã• co::Event ÂΩìÂâçÊòØÊú™ÂêåÊ≠•Áä∂ÊÄÅÔºåÂàôË∞ÉÁî®ÁöÑÂçèÁ®ã‰ºöËøõÂÖ• waiting Áä∂ÊÄÅ„ÄÇ</li>
<li>Âú® co 2.0.0 Âèä‰πãÂâçÁöÑÁâàÊú¨ÔºåÊ≠§ÊñπÊ≥ïÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®„ÄÇ‰ªé 2.0.1 ÁâàÊú¨ÂºÄÂßãÔºåÊ≠§ÊñπÊ≥ïÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®„ÄÇ</li>
<li>Á¨¨ 1 ‰∏™ÁâàÊú¨‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ co::Event Âèò‰∏∫ÂêåÊ≠•Áä∂ÊÄÅ„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÁâàÊú¨‰ºöÈòªÂ°ûÔºåÁõ¥Âà∞ co::Event Âèò‰∏∫ÂêåÊ≠•Áä∂ÊÄÅÊàñË∂ÖÊó∂ÔºåÂèÇÊï∞ ms ÊòØË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´Áßí„ÄÇË∂ÖÊó∂ËøîÂõû falseÔºåÊ≠£Â∏∏ËøîÂõû true„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã-2"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b-2">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>Event ev;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// capture by value, as data on stack may be overwritten by other coroutines.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>go([ev](){
</span></span><span style="display:flex;"><span>    ev.signal();
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ev.wait(<span style="color:#099">100</span>);  <span style="color:#998;font-style:italic">// wait for 100 ms
</span></span></span></code></pre></div><h2 id="waitgroupcowaitgroup"><a class="anchor" href="#waitgroupcowaitgroup">#</a>waitgroup(co::WaitGroup)</h2>
<p><code>co::WaitGroup</code> Á±ª‰ºº‰∫é golang ‰∏≠ÁöÑ <code>sync.WaitGroup</code>ÔºåÂèØÁî®‰∫éÁ≠âÂæÖÂçèÁ®ãÊàñÁ∫øÁ®ãÁöÑÈÄÄÂá∫„ÄÇ</p>
<h3 id="waitgroupwaitgroup"><a class="anchor" href="#waitgroupwaitgroup">#</a>WaitGroup::WaitGroup</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#900;font-weight:bold">WaitGroup</span>(uint32 n);
</span></span><span style="display:flex;"><span>WaitGroup();
</span></span><span style="display:flex;"><span>WaitGroup(WaitGroup<span style="color:#000;font-weight:bold">&amp;&amp;</span> wg);
</span></span><span style="display:flex;"><span>WaitGroup(<span style="color:#000;font-weight:bold">const</span> WaitGroup<span style="color:#000;font-weight:bold">&amp;</span> wg);
</span></span></code></pre></div><ul>
<li>Á¨¨ 1 ‰∏™ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂ∞ÜÂÜÖÈÉ®ËÆ°Êï∞Âô®ÂàùÂßãÂåñ‰∏∫ <code>n</code>„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÊòØÈªòËÆ§ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂ∞ÜÂÜÖÈÉ®ËÆ°Êï∞Âô®ÂàùÂßãÂåñ‰∏∫ 0„ÄÇ</li>
<li>Á¨¨ 3 ‰∏™ÊòØ move ÊûÑÈÄ†ÂáΩÊï∞ÔºåÊîØÊåÅÂ∞Ü co::WaitGroup ÊîæÂÖ• STL ÂÆπÂô®‰∏≠„ÄÇ</li>
<li>Á¨¨ 4 ‰∏™ÊòØÊã∑Ë¥ùÊûÑÈÄ†ÂáΩÊï∞Ôºå‰ªÖÂ∞ÜÂÜÖÈÉ®ÂºïÁî®ËÆ°Êï∞Âä† 1„ÄÇ</li>
</ul>
<h3 id="waitgroupadd"><a class="anchor" href="#waitgroupadd">#</a>WaitGroup::add</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">add</span>(uint32 n<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Â∞ÜÂÜÖÈÉ®ËÆ°Êï∞Âô®Âä† nÔºån ÈªòËÆ§ÂÄºÊòØ 1„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂèØÂú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®„ÄÇ</li>
</ul>
<h3 id="waitgroupdone"><a class="anchor" href="#waitgroupdone">#</a>WaitGroup::done</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">done</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Â∞ÜÂÜÖÈÉ®ËÆ°Êï∞Âô®Âáè 1„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂèØÂú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÈÄöÂ∏∏Âú®ÂçèÁ®ãÊàñÁ∫øÁ®ãÂáΩÊï∞ÁªìÊùüÊó∂Ë∞ÉÁî®„ÄÇ</li>
</ul>
<h3 id="waitgroupwait"><a class="anchor" href="#waitgroupwait">#</a>WaitGroup::wait</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">wait</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Á≠âÂæÖÁõ¥Âà∞ÂÜÖÈÉ®ËÆ°Êï∞Âô®ÁöÑÂÄºÂèò‰∏∫ 0„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã-3"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b-3">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&#34;co/co.h&#34;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span>DEF_main(argc, argv) {
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>WaitGroup wg;
</span></span><span style="display:flex;"><span>    wg.add(<span style="color:#099">8</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> (<span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">8</span>; <span style="color:#000;font-weight:bold">++</span>i) {
</span></span><span style="display:flex;"><span>        go([wg]() {
</span></span><span style="display:flex;"><span>            LOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;co: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> co<span style="color:#000;font-weight:bold">::</span>coroutine_id();
</span></span><span style="display:flex;"><span>            wg.done();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    wg.wait();
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ÂçèÁ®ãÈîÅcomutex"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b%e9%94%81comutex">#</a>ÂçèÁ®ãÈîÅ(co::Mutex)</h2>
<p><code>co::Mutex</code>¬†ÊòØÂçèÁ®ã‰∏≠ÁöÑ‰∫íÊñ•ÈîÅÔºå‰∏éÁ∫øÁ®ã‰∏≠ÁöÑ <code>Mutex</code>¬†Á±ª‰ººÔºåÂè™ÊòØÈúÄË¶ÅÂú®ÂçèÁ®ãÁéØÂ¢É‰∏≠‰ΩøÁî®„ÄÇ</p>
<h3 id="mutexmutex"><a class="anchor" href="#mutexmutex">#</a>Mutex::Mutex</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Mutex();
</span></span><span style="display:flex;"><span>Mutex(Mutex<span style="color:#000;font-weight:bold">&amp;&amp;</span> m);
</span></span><span style="display:flex;"><span>Mutex(<span style="color:#000;font-weight:bold">const</span> Mutex<span style="color:#000;font-weight:bold">&amp;</span> m);
</span></span></code></pre></div><ul>
<li>Á¨¨ 1 ‰∏™ÊòØÈªòËÆ§ÊûÑÈÄ†ÂáΩÊï∞„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÊòØ move ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂèØ‰ª•Â∞Ü co::Mutex ÊîæÂÖ• STL ÂÆπÂô®‰∏≠„ÄÇ</li>
<li>Á¨¨ 3 ‰∏™ÊòØÊã∑Ë¥ùÊûÑÈÄ†ÂáΩÊï∞Ôºå‰ªÖÂ∞ÜÂÜÖÈÉ®ÂºïÁî®ËÆ°Êï∞Âä† 1„ÄÇ</li>
</ul>
<h3 id="mutexlock"><a class="anchor" href="#mutexlock">#</a>Mutex::lock</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">lock</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Ëé∑ÂèñÈîÅÔºå<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>ÈòªÂ°ûÁõ¥Âà∞Ëé∑ÂæóÈîÅ‰∏∫Ê≠¢„ÄÇ</li>
</ul>
<h3 id="mutextry_lock"><a class="anchor" href="#mutextry_lock">#</a>Mutex::try_lock</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">try_lock</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Ëé∑ÂèñÈîÅÔºå‰∏ç‰ºöÈòªÂ°ûÔºåÊàêÂäüËé∑ÂèñÈîÅÊó∂ËøîÂõû trueÔºåÂê¶ÂàôËøîÂõû false„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®Ôºå‰ΩÜ‰∏ÄËà¨ÊòØÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®„ÄÇ</li>
</ul>
<h3 id="mutexunlock"><a class="anchor" href="#mutexunlock">#</a>Mutex::unlock</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">unlock</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>ÈáäÊîæÈîÅÔºåÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®Ôºå‰ΩÜËÆæËÆ°ËâØÂ•ΩÁöÑÁ®ãÂ∫èÔºåÈÄöÂ∏∏ÊòØÁî±‰πãÂâçËé∑ÂæóÈîÅÁöÑÂçèÁ®ãË∞ÉÁî®„ÄÇ</li>
</ul>
<h2 id="comutexguard"><a class="anchor" href="#comutexguard">#</a>co::MutexGuard</h2>
<h3 id="mutexguardmutexguard"><a class="anchor" href="#mutexguardmutexguard">#</a>MutexGuard::MutexGuard</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#900;font-weight:bold">MutexGuard</span>(co<span style="color:#000;font-weight:bold">::</span>Mutex<span style="color:#000;font-weight:bold">&amp;</span> m);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#900;font-weight:bold">MutexGuard</span>(co<span style="color:#000;font-weight:bold">::</span>Mutex<span style="color:#000;font-weight:bold">*</span> m);
</span></span></code></pre></div><ul>
<li>ÊûÑÈÄ†ÂáΩÊï∞ÔºåË∞ÉÁî® m.lock() Ëé∑ÂèñÈîÅÔºåÂèÇÊï∞ m ÊòØ <code>co::Mutex</code>¬†Á±ªÁöÑÂºïÁî®ÊàñÊåáÈíà„ÄÇ</li>
</ul>
<h3 id="mutexguardmutexguard-1"><a class="anchor" href="#mutexguardmutexguard-1">#</a>MutexGuard::~MutexGuard</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">~</span>MutexGuard();
</span></span></code></pre></div><ul>
<li>ÊûêÊûÑÂáΩÊï∞ÔºåÈáäÊîæÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ëé∑ÂæóÁöÑÈîÅ„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã-4"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b-4">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>Mutex mtx;
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> v <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">f1</span>() {
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>MutexGuard g(mtx);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">++</span>v;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">f2</span>() {
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>MutexGuard g(mtx);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">--</span>v;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(f1);
</span></span><span style="display:flex;"><span>go(f2);
</span></span></code></pre></div><h2 id="ÂçèÁ®ãÊ±†copool"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b%e6%b1%a0copool">#</a>ÂçèÁ®ãÊ±†(co::Pool)</h2>
<p><code>co::Pool</code> ÊòØ‰∏ÄÁßçÈÄöÁî®ÁöÑÂçèÁ®ãÊ±†ÔºåÂÆÉÊòØ<strong>ÂçèÁ®ãÂÆâÂÖ®</strong>ÁöÑÔºåÂÜÖÈÉ®Â≠òÂÇ® <code>void*</code>¬†Á±ªÂûãÁöÑÊåáÈíàÔºåÂèØ‰ª•Áî®‰ΩúËøûÊé•Ê±†„ÄÅÂÜÖÂ≠òÊ±†ÊàñÂÖ∂‰ªñÁî®ÈÄîÁöÑÁºìÂ≠ò„ÄÇ</p>
<h3 id="poolpool"><a class="anchor" href="#poolpool">#</a>Pool::Pool</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Pool();
</span></span><span style="display:flex;"><span>Pool(Pool<span style="color:#000;font-weight:bold">&amp;&amp;</span> p);
</span></span><span style="display:flex;"><span>Pool(<span style="color:#000;font-weight:bold">const</span> Pool<span style="color:#000;font-weight:bold">&amp;</span> p);
</span></span><span style="display:flex;"><span>Pool(std<span style="color:#000;font-weight:bold">::</span>function<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span>()<span style="color:#000;font-weight:bold">&gt;&amp;&amp;</span> ccb, std<span style="color:#000;font-weight:bold">::</span>function<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span>(<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span>)<span style="color:#000;font-weight:bold">&gt;&amp;&amp;</span> dcb, size_t cap<span style="color:#000;font-weight:bold">=</span>(size_t)<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>
<p>Á¨¨ 1 ‰∏™ÊòØÈªòËÆ§ÊûÑÈÄ†ÂáΩÊï∞Ôºå‰∏éÁ¨¨ 4 ‰∏™Áõ∏ÊØîÔºåccb ‰∏é dcb ‰∏∫ NULL„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 2 ‰∏™ÊòØ move ÊûÑÈÄ†ÂáΩÊï∞ÔºåÂèØ‰ª•Â∞Ü co::Pool ÊîæÂÖ• STL ÂÆπÂô®‰∏≠„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 3 ‰∏™ÊòØÊã∑Ë¥ùÊûÑÈÄ†ÂáΩÊï∞Ôºå‰ªÖÂ∞ÜÂÜÖÈÉ®ÂºïÁî®ËÆ°Êï∞Âä† 1„ÄÇ</p>
</li>
<li>
<p>Á¨¨ 4 ‰∏™ÊûÑÈÄ†ÂáΩÊï∞‰∏≠ÔºåÂèÇÊï∞ ccb Áî®‰∫éÂàõÂª∫ÂÖÉÁ¥†ÔºåÂèÇÊï∞ dcb Áî®‰∫éÈîÄÊØÅÂÖÉÁ¥†ÔºåÂèÇÊï∞ cap ÊåáÂÆö pool ÁöÑÊúÄÂ§ßÂÆπÈáèÔºåÈªòËÆ§‰∏∫ -1 ‰∏çÈôêÂÆπÈáè„ÄÇ</p>
</li>
<li>
<p>Ê≥®ÊÑèÂèÇÊï∞ cap Âπ∂‰∏çÊòØÊÄªÂÆπÈáèÔºåÂÆÉÊòØÂØπÂçï‰∏™Á∫øÁ®ãËÄåË®ÄÔºåÂú® co::Pool ÂÜÖÈÉ®ÂÆûÁé∞‰∏≠ÔºåÊØè‰∏™Á∫øÁ®ãÈÉΩÊúâËá™Â∑±ÁöÑ poolÔºåÂ¶Ç cap ËÆæÁΩÆ‰∏∫ 1024ÔºåË∞ÉÂ∫¶Á∫øÁ®ãÊúâ 8 ‰∏™ÔºåÂàôÊÄªÂÆπÈáèÊòØ 8192„ÄÇ</p>
</li>
<li>
<p>ÂΩì dcb ‰∏∫ NULL Êó∂Ôºåcap ÂèÇÊï∞‰ºöË¢´ÂøΩÁï•ÔºåËøôÊòØÂõ†‰∏∫ÂΩìÂÖÉÁ¥†‰∏™Êï∞Ë∂ÖËøáÊúÄÂ§ßÂÆπÈáèÊó∂Ôºåco::Pool ÈúÄË¶ÅÁî® dcb ÈîÄÊØÅÂ§ö‰ΩôÁöÑÂÖÉÁ¥†„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">T</span>;
</span></span><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>Pool p(
</span></span><span style="display:flex;"><span>    []() { <span style="color:#000;font-weight:bold">return</span> (<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span>) <span style="color:#000;font-weight:bold">new</span> T; }, <span style="color:#998;font-style:italic">// ccb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    [](<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> p) { <span style="color:#000;font-weight:bold">delete</span> (T<span style="color:#000;font-weight:bold">*</span>) p; }, <span style="color:#998;font-style:italic">// dcb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>);
</span></span></code></pre></div><h3 id="poolclear"><a class="anchor" href="#poolclear">#</a>Pool::clear</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">clear</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Ê∏ÖÁ©∫Êï¥‰∏™ co::PoolÔºåÂèØ‰ª•Âú®‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®„ÄÇ</li>
<li>Â¶ÇÊûúËÆæÁΩÆ‰∫Ü dcbÔºå‰ºöÁî® dcb ÈîÄÊØÅ pool ‰∏≠ÁöÑÂÖÉÁ¥†„ÄÇ</li>
</ul>
<h3 id="poolpop"><a class="anchor" href="#poolpop">#</a>Pool::pop</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">pop</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>‰ªé co::Pool ‰∏≠ÂèñÂá∫‰∏Ä‰∏™ÂÖÉÁ¥†Ôºå<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
<li>co::Pool ‰∏∫Á©∫Êó∂ÔºåËã• ccb ‰∏çÊòØ NULLÔºåÂàôË∞ÉÁî® ccb ÂàõÂª∫‰∏Ä‰∏™ÂÖÉÁ¥†Âπ∂ËøîÂõûÔºåÂê¶ÂàôËøîÂõû NULL„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÊòØÂçèÁ®ãÂÆâÂÖ®ÁöÑÔºå‰∏çÈúÄË¶ÅÂä†ÈîÅ„ÄÇ</li>
</ul>
<h3 id="poolpush"><a class="anchor" href="#poolpush">#</a>Pool::push</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">push</span>(<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> e) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>
<p>Â∞ÜÂÖÉÁ¥†ÊîæÂõû co::Pool ‰∏≠Ôºå<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</p>
</li>
<li>
<p>ÂèÇÊï∞ e ‰∏∫ NULL Êó∂ÔºåÁõ¥Êé•ÂøΩÁï•„ÄÇ</p>
</li>
<li>
<p>Áî±‰∫éÊØè‰∏™Á∫øÁ®ãÂú®ÂÜÖÈÉ®Êã•ÊúâËá™Â∑±ÁöÑ poolÔºå<strong>push() ‰∏é pop() ÊñπÊ≥ïÂ∫îËØ•Âú®Âêå‰∏Ä‰∏™Á∫øÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</p>
</li>
<li>
<p>Ëã• co::Pool Â∑≤ÁªèËææÂà∞ÊúÄÂ§ßÂÆπÈáèÔºå‰∏î dcb ‰∏ç‰∏∫ NULLÔºåÂàôÁõ¥Êé•Ë∞ÉÁî® <code>dcb(e)</code> ÈîÄÊØÅËØ•ÂÖÉÁ¥†„ÄÇ</p>
</li>
<li>
<p>Ê≠§ÊñπÊ≥ïÊòØÂçèÁ®ãÂÆâÂÖ®ÁöÑÔºå‰∏çÈúÄË¶ÅÂä†ÈîÅ„ÄÇ</p>
</li>
<li>
<p>Á§∫‰æã</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Redis</span>;  <span style="color:#998;font-style:italic">// assume class Redis is a connection to the redis server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>co<span style="color:#000;font-weight:bold">::</span>Pool p;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> f {
</span></span><span style="display:flex;"><span>    Redis<span style="color:#000;font-weight:bold">*</span> rds <span style="color:#000;font-weight:bold">=</span> (Redis<span style="color:#000;font-weight:bold">*</span>) p.pop();     <span style="color:#998;font-style:italic">// pop a redis connection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> (rds <span style="color:#000;font-weight:bold">==</span> <span style="color:#0086b3">NULL</span>) rds <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Redis;
</span></span><span style="display:flex;"><span>    rds<span style="color:#000;font-weight:bold">-&gt;</span>get(<span style="color:#d14">&#34;xx&#34;</span>);                    <span style="color:#998;font-style:italic">// call get() method of redis
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    p.push(rds);                       <span style="color:#998;font-style:italic">// push rds back to co::Pool
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(f);
</span></span></code></pre></div><h3 id="poolsize"><a class="anchor" href="#poolsize">#</a>Pool::size</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>size_t <span style="color:#900;font-weight:bold">size</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>ËøîÂõûÂΩìÂâçÁ∫øÁ®ãÁöÑ pool Â§ßÂ∞èÔºå<strong>ÂøÖÈ°ªÂú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®</strong>„ÄÇ</li>
</ul>
<h2 id="copoolguard"><a class="anchor" href="#copoolguard">#</a>co::PoolGuard</h2>
<p><code>co::PoolGuard</code> Âú®ÊûÑÈÄ†Êó∂Ëá™Âä®‰ªé co::Pool ÂèñÂá∫ÂÖÉÁ¥†ÔºåÊûêÊûÑÊó∂Ëá™Âä®Â∞ÜÂÖÉÁ¥†ÊîæÂõû co::Pool„ÄÇÂêåÊó∂ÔºåÂÆÉËøòÈáçËΩΩ‰∫Ü <code>operator-&gt;</code>ÔºåÂèØ‰ª•ÂÉèÊô∫ËÉΩÊåáÈíà‰∏ÄÊ†∑‰ΩøÁî®ÂÆÉ„ÄÇ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">template</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">typename</span> T, <span style="color:#000;font-weight:bold">typename</span> D<span style="color:#000;font-weight:bold">=</span>std<span style="color:#000;font-weight:bold">::</span>default_delete<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PoolGuard</span>;
</span></span></code></pre></div><ul>
<li>ÂèÇÊï∞ T ÊòØ co::Pool ‰∏≠ÊåáÈíàÊâÄÊåáÂêëÁöÑÂÆûÈôÖÁ±ªÂûãÔºåÂèÇÊï∞ D ÊòØ deleterÔºåÁî®‰∫é delete <code>T*</code> Á±ªÂûãÁöÑÊåáÈíà„ÄÇ</li>
</ul>
<h3 id="poolguardpoolguard"><a class="anchor" href="#poolguardpoolguard">#</a>PoolGuard::PoolGuard</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#900;font-weight:bold">PoolGuard</span>(co<span style="color:#000;font-weight:bold">::</span>Pool<span style="color:#000;font-weight:bold">&amp;</span> p);
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#900;font-weight:bold">PoolGuard</span>(co<span style="color:#000;font-weight:bold">::</span>Pool<span style="color:#000;font-weight:bold">*</span> p);
</span></span></code></pre></div><ul>
<li>ÊûÑÈÄ†ÂáΩÊï∞Ôºå‰ªé co::Pool ‰∏≠ÂèñÂá∫‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂèÇÊï∞ p ÊòØ co::Pool Á±ªÁöÑÂºïÁî®ÊàñÊåáÈíà„ÄÇ</li>
</ul>
<h3 id="poolguardpoolguard-1"><a class="anchor" href="#poolguardpoolguard-1">#</a>PoolGuard::~PoolGuard</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">~</span>PoolGuard();
</span></span></code></pre></div><ul>
<li>ÊûêÊûÑÂáΩÊï∞ÔºåÂ∞ÜÊûÑÈÄ†ÂáΩÊï∞‰∏≠Ëé∑ÂèñÁöÑÂÖÉÁ¥†ÔºåÊîæÂõû co::Pool ‰∏≠„ÄÇ</li>
</ul>
<h3 id="poolguardget"><a class="anchor" href="#poolguardget">#</a>PoolGuard::get</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>T<span style="color:#000;font-weight:bold">*</span> <span style="color:#900;font-weight:bold">get</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Ëé∑Âèñ‰ªé co::Pool ‰∏≠ÂèñÂá∫ÁöÑÊåáÈíà„ÄÇ</li>
</ul>
<h3 id="poolguardoperator-"><a class="anchor" href="#poolguardoperator-">#</a>PoolGuard::operator-&gt;</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>T<span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">-&gt;</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>ÈáçËΩΩ <code>operator-&gt;</code>ÔºåËøîÂõû‰ªé co::Pool ‰∏≠ÂèñÂá∫ÁöÑÂÖÉÁ¥†„ÄÇ</li>
</ul>
<h3 id="poolguardoperator"><a class="anchor" href="#poolguardoperator">#</a>PoolGuard::operator*</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>T<span style="color:#000;font-weight:bold">&amp;</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">*</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>ÈáçËΩΩ <code>operator*</code>ÔºåËøîÂõû T Á±ªÁöÑÂºïÁî®„ÄÇ</li>
</ul>
<h3 id="poolguardoperator-bool"><a class="anchor" href="#poolguardoperator-bool">#</a>PoolGuard::operator bool</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">explicit</span> <span style="color:#000;font-weight:bold">operator</span> <span style="color:#900;font-weight:bold">bool</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Â∞Ü co::PoolGuard ËΩ¨Êç¢‰∏∫ bool Á±ªÂûãÔºåËã•ÂÜÖÈÉ®ÊåáÈíà‰∏çÊòØ NULLÔºåËøîÂõû trueÔºåÂê¶ÂàôËøîÂõû false„ÄÇ</li>
</ul>
<h3 id="poolguardoperator-1"><a class="anchor" href="#poolguardoperator-1">#</a>PoolGuard::operator!</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">!</span>() <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Âà§Êñ≠ÂÜÖÈÉ®ÊåáÈíàÊòØÂê¶‰∏∫ NULLÔºå‰∏∫ NULL Êó∂ËøîÂõû trueÔºåÂê¶ÂàôËøîÂõû false„ÄÇ</li>
</ul>
<h3 id="poolguardoperator-2"><a class="anchor" href="#poolguardoperator-2">#</a>PoolGuard::operator==</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">==</span>(T<span style="color:#000;font-weight:bold">*</span> p) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Âà§Êñ≠ÂÜÖÈÉ®ÊåáÈíàÊòØÂê¶Á≠â‰∫é p„ÄÇ</li>
</ul>
<h3 id="poolguardoperator-3"><a class="anchor" href="#poolguardoperator-3">#</a>PoolGuard::operator!=</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">!=</span>(T<span style="color:#000;font-weight:bold">*</span> p) <span style="color:#000;font-weight:bold">const</span>;
</span></span></code></pre></div><ul>
<li>Âà§Êñ≠ÂÜÖÈÉ®ÊåáÈíàÊòØÂê¶‰∏çÁ≠â‰∫é p„ÄÇ</li>
</ul>
<h3 id="poolguardoperator-4"><a class="anchor" href="#poolguardoperator-4">#</a>PoolGuard::operator=</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">operator</span><span style="color:#000;font-weight:bold">=</span>(T<span style="color:#000;font-weight:bold">*</span> p);
</span></span></code></pre></div><ul>
<li>ËµãÂÄºÊìç‰ΩúÔºåÁ≠â‰ª∑‰∫é <code>reset(p)</code>„ÄÇ</li>
</ul>
<h3 id="poolguardreset"><a class="anchor" href="#poolguardreset">#</a>PoolGuard::reset</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">reset</span>(T<span style="color:#000;font-weight:bold">*</span> p <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>);
</span></span></code></pre></div><ul>
<li>ÈáçÁΩÆÂÜÖÈÉ®ÊåáÈíàÔºåÂπ∂Ë∞ÉÁî® <code>D()(x)</code> Âà†Èô§ÂéüÂÖàÁöÑÊåáÈíà„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã-5"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b-5">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>Pool p(
</span></span><span style="display:flex;"><span>	[]() { <span style="color:#000;font-weight:bold">return</span> (<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span>) <span style="color:#000;font-weight:bold">new</span> string; }, <span style="color:#998;font-style:italic">// ccb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>	[](<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> p) { <span style="color:#000;font-weight:bold">delete</span> (string<span style="color:#000;font-weight:bold">*</span>)p; }  <span style="color:#998;font-style:italic">// dcb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>);
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">fs</span>() {
</span></span><span style="display:flex;"><span>	co<span style="color:#000;font-weight:bold">::</span>PoolGuard<span style="color:#000;font-weight:bold">&lt;</span>string<span style="color:#000;font-weight:bold">&gt;</span> rds(p); <span style="color:#998;font-style:italic">// now rds can be used like a Redis* pointer.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>	rds<span style="color:#000;font-weight:bold">-&gt;</span>append(<span style="color:#d14">&#34;xx&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(fs);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Redis</span>;  <span style="color:#998;font-style:italic">// assume class Redis is a connection to the redis server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>Pool p(
</span></span><span style="display:flex;"><span>    []() { <span style="color:#000;font-weight:bold">return</span> (<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span>) <span style="color:#000;font-weight:bold">new</span> Redis; }, <span style="color:#998;font-style:italic">// ccb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    [](<span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> p) { <span style="color:#000;font-weight:bold">delete</span> (Redis<span style="color:#000;font-weight:bold">*</span>) p; }  <span style="color:#998;font-style:italic">// dcb
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">f</span>() {
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>PoolGuard<span style="color:#000;font-weight:bold">&lt;</span>Redis<span style="color:#000;font-weight:bold">&gt;</span> rds(p); <span style="color:#998;font-style:italic">// now rds can be used like a Redis* pointer.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    rds<span style="color:#000;font-weight:bold">-&gt;</span>get(<span style="color:#d14">&#34;xx&#34;</span>);<span style="color:#998;font-style:italic">//redisÁöÑÊñπÊ≥ï
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(f);
</span></span></code></pre></div><p>‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠Ôºåco::Pool Áõ∏ÂΩì‰∫é redis ËøûÊé•Ê±†„ÄÇÂ¶ÇÊûú‰ΩøÁî® CLS Êú∫Âà∂Ôºå‰∏Ä‰∏™ÂçèÁ®ã‰∏Ä‰∏™ËøûÊé•ÔºåÂàô 100 ‰∏áÂçèÁ®ãÈúÄË¶ÅÂª∫Á´ã 100 ‰∏áËøûÊé•ÔºåÊ∂àËÄóËæÉÂ§ß„ÄÇ‰ΩÜ‰ΩøÁî® pool Êú∫Âà∂Ôºå100 ‰∏áÂçèÁ®ãÂèØËÉΩÂè™ÈúÄË¶ÅÂÖ±Áî®Â∞ëÈáèÁöÑËøûÊé•„ÄÇpool Êú∫Âà∂ÊØî CLS Êõ¥È´òÊïà„ÄÅÊõ¥ÂêàÁêÜÔºåËøô‰πüÊòØ CO ‰∏çÊîØÊåÅ CLS ÁöÑÂéüÂõ†„ÄÇ</p>
<h2 id="io-‰∫ã‰ª∂coioevent"><a class="anchor" href="#io-%e4%ba%8b%e4%bb%b6coioevent">#</a>I/O ‰∫ã‰ª∂(co::IoEvent)</h2>
<p><code>co::IoEvent</code>¬†Áî®‰∫é<strong>Â∞ÜÈùûÈòªÂ°û I/O ËΩ¨Êç¢‰∏∫ÂêåÊ≠•ÊñπÂºè</strong>„ÄÇÁî®Êà∑Âú®<strong>ÂçèÁ®ã</strong>‰∏≠ÂØπ‰∏Ä‰∏™ <strong>non-blocking socket</strong> ËøõË°å I/O Êìç‰ΩúÔºåÂΩì socket ‰∏çÂèØËØªÊàñ‰∏çÂèØÂÜôÊó∂ÔºåÁî®Êà∑Ë∞ÉÁî® co::IoEvent ÁöÑ <code>wait()</code>¬†ÊñπÊ≥ïÊåÇËµ∑ÂçèÁ®ãÔºåÁ≠âÂæÖ I/O ‰∫ã‰ª∂ÔºõÂΩì socket Âèò‰∏∫ÂèØËØªÊàñÂèØÂÜôÊó∂ÔºåË∞ÉÂ∫¶Á∫øÁ®ãÈáçÊñ∞Âî§ÈÜíËØ•ÂçèÁ®ãÔºåÁªßÁª≠ I/O Êìç‰Ωú„ÄÇ</p>
<p><strong>co 1.x</strong> ÁâàÊú¨Âπ∂Ê≤°ÊúâÂÖ¨ÂºÄ co::IoEvent Á±ªÔºåÂè™ÊòØÂú® co ÂÜÖÈÉ®‰ΩøÁî®Ôºå<strong>co 2.0</strong> ‰∏≠Â∞ÜËøô‰∏™Á±ªÂÖ¨ÂºÄÔºåÊñπ‰æøÁî®Êà∑Â∞Ü‰∏âÊñπÁΩëÁªúÂ∫ìÂçèÁ®ãÂåñ„ÄÇ</p>
<h3 id="coio_event_t"><a class="anchor" href="#coio_event_t">#</a>co::io_event_t</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">enum</span> <span style="color:#458;font-weight:bold">io_event_t</span> {
</span></span><span style="display:flex;"><span>    ev_read <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>,
</span></span><span style="display:flex;"><span>    ev_write <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>,
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><ul>
<li>enum Á±ªÂûãÔºåË°®Á§∫ I/O ‰∫ã‰ª∂Á±ªÂûãÔºåco::ev_read Ë°®Á§∫ËØªÔºåco::ev_write Ë°®Á§∫ÂÜô„ÄÇ</li>
</ul>
<h3 id="ioeventioevent"><a class="anchor" href="#ioeventioevent">#</a>IoEvent::IoEvent</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>IoEvent(sock_t fd, io_event_t ev);
</span></span><span style="display:flex;"><span>IoEvent(sock_t fd, <span style="color:#458;font-weight:bold">int</span> n<span style="color:#000;font-weight:bold">=</span><span style="color:#099">0</span>);  <span style="color:#998;font-style:italic">// for windows only
</span></span></span></code></pre></div><ul>
<li>ÊûÑÈÄ†ÂáΩÊï∞Ôºålinux ‰∏é mac Âπ≥Âè∞Âè™Êèê‰æõÁ¨¨ 1 ‰∏™ÁâàÊú¨Ôºåwindows Âπ≥Âè∞ËøòÊèê‰æõÁ¨¨ 2 ‰∏™ÁâàÊú¨„ÄÇ</li>
<li>Á¨¨ 1 ‰∏™ÁâàÊú¨‰∏≠Ôºå<strong>ÂèÇÊï∞ fd ÊòØ‰∏Ä‰∏™ non-blocking socket</strong>ÔºåÂèÇÊï∞ ev ÊòØ I/O ‰∫ã‰ª∂Á±ªÂûãÔºåÂè™ËÉΩÊòØ co::ev_read Êàñ co::ev_write ‰∏≠ÁöÑ‰∏ÄÁßç„ÄÇË∞ÉÁî® wait() ÊñπÊ≥ï‰ºöÂú® socket ‰∏äÁ≠âÂæÖ ev ÊåáÂÆöÁöÑ I/O ‰∫ã‰ª∂Ôºåwait() ÊàêÂäüËøîÂõûÊó∂ÔºåÈúÄË¶ÅÁî®Êà∑Ë∞ÉÁî® recv, send Á≠âÂáΩÊï∞ÂÆåÊàê I/O Êìç‰Ωú„ÄÇ<strong>Âú® windows Âπ≥Âè∞Ôºåfd ÂøÖÈ°ªÊòØ TCP socket</strong>(ÂØπ‰∫é UDPÔºåÂæàÈöæÁî® IOCP Ê®°Êãü epoll Êàñ kqueue ÁöÑË°å‰∏∫)„ÄÇ</li>
<li>Á¨¨ 2 ‰∏™ÁâàÊú¨‰ªÖÈÄÇÁî®‰∫é windowsÔºå‰∏éÁ¨¨ 1 ‰∏™ÁâàÊú¨‰∏çÂêåÔºåfd ÂèØ‰ª•ÊòØ UDP socketÔºå‰ΩÜÁî®Êà∑ÈúÄË¶ÅÊâãÂä®Ë∞ÉÁî® WSARecvFrom, WSASendTo Á≠âÂáΩÊï∞Âêë IOCP ÂèëÈÄÅ overlapped I/O ËØ∑Ê±ÇÔºåÁÑ∂ÂêéË∞ÉÁî® wait() ÊñπÊ≥ïÔºåÂΩì wait() ÊàêÂäüËøîÂõûÊó∂ÔºåË°®Á§∫ IOCP Â∑≤ÁªèÂ∏ÆÁî®Êà∑ÂÆåÊàê‰∫Ü I/O Êìç‰Ωú„ÄÇÂÖ∑‰ΩìÁöÑÁî®Ê≥ïÊ≠§Â§Ñ‰∏çËØ¶Ëø∞Ôºå‰ª£Á†Å‰∏≠ÊúâËØ¶ÁªÜÁöÑÊ≥®ÈáäÔºåÂª∫ËÆÆÁõ¥Êé•ÂèÇËÄÉ <a href="https://github.com/idealvin/co/blob/master/include/co/co/io_event.h">co::IoEvent ÁöÑÊ∫êÁ†Å</a>Ôºå‰ª•Âèä windows ‰∏ä <a href="https://github.com/idealvin/co/blob/master/src/co/sock_win.cc">co::accept, co::connect, co::recvfrom, co::sendto ÁöÑÂÆûÁé∞</a>„ÄÇ</li>
</ul>
<h3 id="ioeventioevent-1"><a class="anchor" href="#ioeventioevent-1">#</a>IoEvent::~IoEvent</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">~</span>IoEvent();
</span></span></code></pre></div><ul>
<li>ÊûêÊûÑÂáΩÊï∞Ôºå‰ªé epoll Êàñ kqueue ‰∏≠ÁßªÈô§‰πãÂâçÊ≥®ÂÜåÁöÑ I/O ‰∫ã‰ª∂„ÄÇ</li>
</ul>
<h3 id="ioeventwait"><a class="anchor" href="#ioeventwait">#</a>IoEvent::wait</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">bool</span> <span style="color:#900;font-weight:bold">wait</span>(<span style="color:#458;font-weight:bold">int</span> ms<span style="color:#000;font-weight:bold">=-</span><span style="color:#099">1</span>);
</span></span></code></pre></div><ul>
<li>Ê≠§ÊñπÊ≥ïÁ≠âÂæÖ socket ‰∏äÁöÑ I/O ‰∫ã‰ª∂ÔºåÂèÇÊï∞ ms ÊòØË∂ÖÊó∂Êó∂Èó¥ÔºåÂçï‰Ωç‰∏∫ÊØ´ÁßíÔºåÈªòËÆ§‰∏∫ -1ÔºåÊ∞∏‰∏çË∂ÖÊó∂„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÈòªÂ°ûÔºåÁõ¥Âà∞ I/O ‰∫ã‰ª∂Âà∞Êù•ÔºåÊàñËÄÖË∂ÖÊó∂„ÄÅÂèëÁîüÈîôËØØ„ÄÇ</li>
<li>Ê≠§ÊñπÊ≥ïÊàêÂäüÊó∂ËøîÂõû trueÔºåË∂ÖÊó∂ÊàñÂèëÁîüÈîôËØØÊó∂ËøîÂõû false„ÄÇÁî®Êà∑ÂèØ‰ª•Áî® <code>co::timeout()</code>¬†Âà§Êñ≠ÊòØÂê¶Ë∂ÖÊó∂„ÄÇ</li>
</ul>
<h3 id="‰ª£Á†ÅÁ§∫‰æã-6"><a class="anchor" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b-6">#</a>‰ª£Á†ÅÁ§∫‰æã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">recv</span>(sock_t fd, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#458;font-weight:bold">int</span> ms) {
</span></span><span style="display:flex;"><span>    CHECK(gSched) <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;must be called in coroutine..&#34;</span>;
</span></span><span style="display:flex;"><span>    co<span style="color:#000;font-weight:bold">::</span>IoEvent ev(fd, co<span style="color:#000;font-weight:bold">::</span>ev_read);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> r <span style="color:#000;font-weight:bold">=</span> (<span style="color:#458;font-weight:bold">int</span>) CO_RAW_API(recv)(fd, buf, n, <span style="color:#099">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (r <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>) <span style="color:#000;font-weight:bold">return</span> r;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (errno <span style="color:#000;font-weight:bold">==</span> EWOULDBLOCK <span style="color:#000;font-weight:bold">||</span> errno <span style="color:#000;font-weight:bold">==</span> EAGAIN) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">!</span>ev.wait(ms)) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> (errno <span style="color:#000;font-weight:bold">!=</span> EINTR) {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">while</span> (<span style="color:#0086b3">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>‰∏äÈù¢ÁöÑ‰æãÂ≠êÊòØ <code>co::recv</code> ÁöÑÂÆûÁé∞ÔºåË∞ÉÁî®ÂéüÁîü recv ÊñπÊ≥ï‰∫ßÁîü EWOULDBLOCK Êàñ EAGAIN ÈîôËØØÊó∂ÔºåÁî® co::IoEvent Á≠âÂæÖËØª‰∫ã‰ª∂Ôºåwait() Ê≠£Â∏∏ËøîÂõûÊó∂Ë°®Á§∫ socket ÂèØËØªÔºåÁªßÁª≠Ë∞ÉÁî®ÂéüÁîü recv ÊñπÊ≥ïÂÆåÊàêËØªÊìç‰Ωú„ÄÇ</p>
<h2 id="ÂçèÁ®ã‰∏≠‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ì"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b%e4%b8%ad%e4%bd%bf%e7%94%a8%e4%b8%89%e6%96%b9%e7%bd%91%e7%bb%9c%e5%ba%93">#</a>ÂçèÁ®ã‰∏≠‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ì</h2>
<p>Âú®ÂçèÁ®ã‰∏≠Áõ¥Êé•‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ìÊó∂ÔºåÊúâÂèØËÉΩÈòªÂ°ûË∞ÉÂ∫¶Á∫øÁ®ãÔºåÂØºËá¥Ë∞ÉÂ∫¶Á∫øÁ®ãÊó†Ê≥ïÊ≠£Â∏∏Â∑•‰Ωú„ÄÇËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÊúâ‰∏§ÁßçÊñπÊ≥ïÔºåÁ¨¨‰∏ÄÁßçÊòØÂ∞Ü‰∏âÊñπÂ∫ìÂçèÁ®ãÂåñÔºåÁ¨¨‰∫åÁßçÊòØ hook Á≥ªÁªü‰∏≠ÁöÑ socket APIÔºå‰∏ãÈù¢ÂàÜÂà´‰ªãÁªç„ÄÇ</p>
<h3 id="ÂçèÁ®ãÂåñ"><a class="anchor" href="#%e5%8d%8f%e7%a8%8b%e5%8c%96">#</a>ÂçèÁ®ãÂåñ</h3>
<p>ÂçèÁ®ãÂåñÈúÄË¶Å‰∏âÊñπÂ∫ìÊèê‰æõÈùûÈòªÂ°û APIÔºåÂà©Áî® co::IoEvent ÂèØ‰ª•ËΩªÊùæÂ∞ÜËøô‰∫õ API ËΩ¨Êç¢‰∏∫ÂçèÁ®ãÂêåÊ≠•ÊñπÂºè„ÄÇ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">recv</span>(SSL<span style="color:#000;font-weight:bold">*</span> s, <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> buf, <span style="color:#458;font-weight:bold">int</span> n, <span style="color:#458;font-weight:bold">int</span> ms) {
</span></span><span style="display:flex;"><span>    CHECK(co<span style="color:#000;font-weight:bold">::</span>scheduler()) <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;must be called in coroutine..&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> r, e;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> fd <span style="color:#000;font-weight:bold">=</span> SSL_get_fd(s);
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span> (fd <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">do</span> {
</span></span><span style="display:flex;"><span>        ERR_clear_error();
</span></span><span style="display:flex;"><span>        r <span style="color:#000;font-weight:bold">=</span> SSL_read(s, buf, n);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (r <span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#099">0</span>) <span style="color:#000;font-weight:bold">return</span> r; <span style="color:#998;font-style:italic">// success
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> (r <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span>) {
</span></span><span style="display:flex;"><span>            DLOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;SSL_read return 0, error: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> SSL_get_error(s, <span style="color:#099">0</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>        e <span style="color:#000;font-weight:bold">=</span> SSL_get_error(s, r);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (e <span style="color:#000;font-weight:bold">==</span> SSL_ERROR_WANT_READ) {
</span></span><span style="display:flex;"><span>            co<span style="color:#000;font-weight:bold">::</span>IoEvent ev(fd, co<span style="color:#000;font-weight:bold">::</span>ev_read);
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">!</span>ev.wait(ms)) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> (e <span style="color:#000;font-weight:bold">==</span> SSL_ERROR_WANT_WRITE) {
</span></span><span style="display:flex;"><span>            co<span style="color:#000;font-weight:bold">::</span>IoEvent ev(fd, co<span style="color:#000;font-weight:bold">::</span>ev_write);
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">!</span>ev.wait(ms)) <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            DLOG <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;SSL_read return &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> r <span style="color:#000;font-weight:bold">&lt;&lt;</span> <span style="color:#d14">&#34;, error: &#34;</span> <span style="color:#000;font-weight:bold">&lt;&lt;</span> e;
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> r;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#000;font-weight:bold">while</span> (<span style="color:#0086b3">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>‰∏äÈù¢ÊòØÂ∞Ü openssl ‰∏≠ÁöÑ SSL_read ÂçèÁ®ãÂåñÁöÑ‰æãÂ≠êÔºåÊï¥‰∏™ËøáÁ®ãÊØîËæÉÁÆÄÂçïÔºåÂ∫ïÂ±Ç‰ΩøÁî® non-blocking socketÔºåÂú® SSL_read ‰∫ßÁîü <code>SSL_ERROR_WANT_READ</code>¬†ÈîôËØØÊó∂ÔºåÁî® co::IoEvent Á≠âÂæÖËØª‰∫ã‰ª∂Ôºå‰∫ßÁîü <code>SSL_ERROR_WANT_WRITE</code>¬†ÈîôËØØÊó∂ÔºåÁî® co::IoEvent Á≠âÂæÖÂÜô‰∫ã‰ª∂Ôºåwait() Ê≠£Â∏∏ËøîÂõûÊó∂ÔºåË°®Á§∫ socket ÂèØËØªÊàñÂèØÂÜôÔºåÁªßÁª≠Ë∞ÉÁî® SSL_read ÂÆåÊàê I/O Êìç‰Ωú„ÄÇ</p>
<p>ÁõÆÂâçÔºåCO Â∑≤ÁªèÊàêÂäüÂ∞Ü openssl, libcurl ÂçèÁ®ãÂåñ„ÄÇÁêÜËÆ∫‰∏äÔºåÊîØÊåÅÈùûÈòªÂ°û I/O Êìç‰ΩúÁöÑ‰∏âÊñπÁΩëÁªúÂ∫ìÔºåÈÉΩÂèØ‰ª•Áî®‰∏é‰∏äÈù¢Á±ª‰ººÁöÑÊñπÊ≥ïÂçèÁ®ãÂåñ„ÄÇ</p>
<h3 id="Á≥ªÁªü-api-hook"><a class="anchor" href="#%e7%b3%bb%e7%bb%9f-api-hook">#</a>Á≥ªÁªü API hook</h3>
<p>API hook ÁÆÄÂçïÊù•ËØ¥Â∞±ÊòØÊã¶Êà™Á≥ªÁªü API ËØ∑Ê±ÇÔºåÂ¶ÇÊûúÂèëÁé∞ËØ•ËØ∑Ê±ÇÊòØÂú®ÂçèÁ®ã‰∏≠Ôºå‰∏î‰ΩøÁî® blocking socketÔºåÂ∞±Â∞Ü socket ‰øÆÊîπÊàê non-blocking Ê®°ÂºèÔºåÁÑ∂ÂêéÂà©Áî® co::IoEvent Êàñ CO ‰∏≠Êõ¥Â∫ïÂ±ÇÁöÑÊé•Âè£ÔºåÁ≠âÂæÖ socket ‰∏äÁöÑ I/O ‰∫ã‰ª∂ÔºåI/O ‰∫ã‰ª∂Âà∞Êù•Êó∂ÔºåÂÜçÂî§ÈÜíÂçèÁ®ãÔºåË∞ÉÁî®ÂéüÁîüÁöÑ socket api ÂÆåÊàê I/O Êìç‰Ωú„ÄÇ</p>
<p>‰ªé CO 2.0.1 ÂºÄÂßãÔºåÂú® linux, mac ‰∏é windows Âπ≥Âè∞ÂùáÂ∑≤ÊîØÊåÅ hook„ÄÇ</p>
<p><strong>API hook ‰∏éÂçèÁ®ãÂåñÁöÑÂå∫Âà´</strong>Âú®‰∫éÔºöÂâçËÄÖÊòØÂ∞ÜÈòªÂ°û API ËΩ¨Êç¢ÊàêÂçèÁ®ãÂêåÊ≠•ÊñπÂºèÔºåÂêéËÄÖÊòØÂ∞ÜÈùûÈòªÂ°û API ËΩ¨Êç¢ÊàêÂçèÁ®ãÂêåÊ≠•ÊñπÂºè„ÄÇÂçèÁ®ãÂêåÊ≠•ÊñπÂºèÊòØÊåáÂçèÁ®ãÂèØËÉΩ‰ºöÈòªÂ°ûÔºå‰ªéÂçèÁ®ãÁöÑËßíÂ∫¶ÁúãÊòØÂêåÊ≠•ÁöÑÔºå‰ΩÜË∞ÉÂ∫¶Á∫øÁ®ã‰∏ç‰ºöÈòªÂ°ûÔºåÂÆÉÂèØ‰ª•ÂàáÊç¢Âà∞ÂÖ∂‰ªñÂçèÁ®ãËøêË°å„ÄÇÂè¶Â§ñÔºåÂÆÉ‰ª¨ÁöÑ‰ΩøÁî®ÊñπÂºè‰πüÊòØ‰∏çÂêåÁöÑÔºåÂâçËÄÖÈúÄË¶ÅÂú®ÂçèÁ®ã‰∏≠Áî®ÈòªÂ°ûÁöÑÊñπÂºèË∞ÉÁî®ÂéüÁîü APIÔºåÂêéËÄÖÂàôÁõ¥Êé•Âú®ÂçèÁ®ã‰∏≠Ë∞ÉÁî®ÂçèÁ®ãÂåñÁöÑ API„ÄÇ</p>
<p>API hook ÁöÑÂ•ΩÂ§ÑÂú®‰∫éÔºåÂè™ÈúÄË¶Å hook Á≥ªÁªü‰∏≠ÁöÑÂ∞ëÈáè socket APIÔºåÂ∞±ÂèØ‰ª•Âú®ÂçèÁ®ã‰∏≠‰ΩøÁî®ÊâÄÊúâÊèê‰æõÈòªÂ°û API ÁöÑ‰∏âÊñπÂ∫ì„ÄÇÂçèÁ®ãÂåñÂàôÈúÄË¶Å‰∏∫ÊØè‰∏™‰∏âÊñπÂ∫ìÂêÑÊèê‰æõ‰∏ÄÂ•óÂçèÁ®ãÂåñÁöÑ APIÔºå‰ΩÜÂÆÉÊØî API hook ÊÄßËÉΩÊõ¥Â•ΩÔºå‰∏îÊõ¥ÂÆâÂÖ®ÔºåÂèØ‰ª•ÈÅøÂÖçÁî±‰∏âÊñπÂ∫ìÁöÑÂ§çÊùÇÊÄßÂºïËµ∑ÁöÑ‰∏Ä‰∫õÈóÆÈ¢ò„ÄÇ</p>
<h2 id="Âü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ãÊ®°Âºè"><a class="anchor" href="#%e5%9f%ba%e4%ba%8e%e5%8d%8f%e7%a8%8b%e7%9a%84%e7%bd%91%e7%bb%9c%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f">#</a>Âü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ãÊ®°Âºè</h2>
<p>ÂçèÁ®ãÂèØ‰ª•Áî®ÂêåÊ≠•ÁöÑÊñπÂºèÔºåÂÆûÁé∞È´òÂπ∂Âèë„ÄÅÈ´òÊÄßËÉΩÁöÑÁΩëÁªúÁ®ãÂ∫è„ÄÇÂçèÁ®ãËôΩÁÑ∂‰ºöÈòªÂ°ûÔºå‰ΩÜË∞ÉÂ∫¶Á∫øÁ®ãÂèØ‰ª•Âú®Â§ßÈáèÁöÑÂçèÁ®ãÈó¥Âø´ÈÄüÂàáÊç¢ÔºåÂõ†Ê≠§Ë¶ÅÂÆûÁé∞È´òÂπ∂ÂèëÔºåÂè™ÈúÄË¶ÅÂàõÂª∫Êõ¥Â§öÁöÑÂçèÁ®ãÂç≥ÂèØ„ÄÇ</p>
<p>‰ª• TCP Á®ãÂ∫è‰∏∫‰æãÔºåÊúçÂä°Á´Ø‰∏ÄËà¨ÈááÁî®‰∏Ä‰∏™ËøûÊé•‰∏Ä‰∏™ÂçèÁ®ãÁöÑÊ®°ÂºèÔºå‰∏∫ÊØè‰∏™ÂÆ¢Êà∑Á´ØËøûÊé•ÂàõÂª∫Êñ∞ÁöÑÂçèÁ®ãÔºåÂú®ÂçèÁ®ã‰∏≠Â§ÑÁêÜËøûÊé•‰∏äÁöÑÊï∞ÊçÆ„ÄÇÂÆ¢Êà∑Á´ØÊ≤°ÂøÖË¶Å‰∏Ä‰∏™ËøûÊé•‰∏Ä‰∏™ÂçèÁ®ãÔºå‰∏ÄËà¨‰ΩøÁî®ËøûÊé•Ê±†ÔºåÂ§ö‰∏™ÂçèÁ®ãÂÖ±Áî®ËøûÊé•Ê±†‰∏≠ÁöÑËøûÊé•„ÄÇ</p>
<h3 id="ÊúçÂä°Á´ØÁΩëÁªúÊ®°Âûã"><a class="anchor" href="#%e6%9c%8d%e5%8a%a1%e7%ab%af%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b">#</a>ÊúçÂä°Á´ØÁΩëÁªúÊ®°Âûã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// recv or send data on the connection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">on_connection</span>(<span style="color:#458;font-weight:bold">int</span> fd) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> (<span style="color:#0086b3">true</span>) {
</span></span><span style="display:flex;"><span>        co<span style="color:#000;font-weight:bold">::</span>recv(fd, ...);  <span style="color:#998;font-style:italic">// recv request from client
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        process(...);       <span style="color:#998;font-style:italic">// process the request
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        co<span style="color:#000;font-weight:bold">::</span>send(fd, ...);  <span style="color:#998;font-style:italic">// send response to client
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">server_fun</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> (<span style="color:#0086b3">true</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> fd <span style="color:#000;font-weight:bold">=</span> co<span style="color:#000;font-weight:bold">::</span>accept(...);
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (fd <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>) go(on_connection, fd);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(server_fun);
</span></span></code></pre></div><ul>
<li>ÊúçÂä°Á´ØÈááÁî®‰∏Ä‰∏™ËøûÊé•‰∏Ä‰∏™ÂçèÁ®ãÁöÑÊ®°Âûã„ÄÇ</li>
<li>Âú®‰∏Ä‰∏™ÂçèÁ®ã‰∏≠ÔºåË∞ÉÁî® <code>co::accept()</code>¬†Êé•ÂèóÂÆ¢Êà∑Á´ØËøûÊé•„ÄÇ</li>
<li>ÊúâËøûÊé•Âà∞Êù•Êó∂ÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂçèÁ®ãÔºåÂú®ÂçèÁ®ã‰∏≠Â§ÑÁêÜËøûÊé•‰∏äÁöÑÊï∞ÊçÆ„ÄÇ</li>
<li><code>on_connection()</code>¬†ÊòØÂ§ÑÁêÜËøûÊé•ÁöÑÂçèÁ®ãÂáΩÊï∞ÔºåÊé•Êî∂„ÄÅÂ§ÑÁêÜ‰∏éÂèëÈÄÅÊï∞ÊçÆÔºåÂú®ËØ•ÂçèÁ®ã‰∏≠‰ª•ÂÆåÂÖ®ÂêåÊ≠•ÁöÑÊñπÂºèËøõË°åÔºå‰∏çÈúÄË¶Å‰ªª‰ΩïÂºÇÊ≠•ÂõûË∞É„ÄÇ</li>
<li>ÂÆåÊï¥ÁöÑÂÆûÁé∞ÂèØ‰ª•ÂèÇËÄÉ <a href="https://github.com/idealvin/co/blob/master/test/so/tcp2.cc">co ‰∏≠ÁöÑÊµãËØï‰ª£Á†Å</a>„ÄÇ</li>
</ul>
<h3 id="ÂÆ¢Êà∑Á´ØÁΩëÁªúÊ®°Âûã"><a class="anchor" href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e7%bd%91%e7%bb%9c%e6%a8%a1%e5%9e%8b">#</a>ÂÆ¢Êà∑Á´ØÁΩëÁªúÊ®°Âûã</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">client_fun</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#0086b3">true</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">!</span>connected) co<span style="color:#000;font-weight:bold">::</span>connect(...);  <span style="color:#998;font-style:italic">// connect to the server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        co<span style="color:#000;font-weight:bold">::</span>send(...);                     <span style="color:#998;font-style:italic">// send request to the server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        co<span style="color:#000;font-weight:bold">::</span>recv(...);                     <span style="color:#998;font-style:italic">// recv response from the server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        process(...);                      <span style="color:#998;font-style:italic">// process the response
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> (over) co<span style="color:#000;font-weight:bold">::</span>close(...);          <span style="color:#998;font-style:italic">// close the connection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(client_fun);
</span></span></code></pre></div><ul>
<li>Âª∫Á´ãËøûÊé•ÔºåÂèëÈÄÅ„ÄÅÊé•Êî∂„ÄÅÂ§ÑÁêÜÊï∞ÊçÆÔºåÂú®ÂçèÁ®ã‰∏≠‰ª•ÂÆåÂÖ®ÂêåÊ≠•ÁöÑÊñπÂºèËøõË°å„ÄÇ</li>
<li>ÂÆåÊï¥ÁöÑÂÆûÁé∞ÂèØ‰ª•ÂèÇËÄÉ <a href="https://github.com/idealvin/co/blob/master/test/so/tcp2.cc">co ‰∏≠ÁöÑÊµãËØï‰ª£Á†Å</a>„ÄÇ</li>
</ul>
<p>ÂÆûÈôÖÂ∫îÁî®‰∏≠Ôºå‰∏ÄËà¨‰ΩøÁî® <strong>co::Pool</strong> ‰Ωú‰∏∫ËøûÊé•Ê±†Ôºå‰ª•ÈÅøÂÖçÂàõÂª∫ËøáÂ§öÁöÑËøûÊé•Ôºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>co<span style="color:#000;font-weight:bold">::</span>Pool pool;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">client_fun</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">while</span> <span style="color:#0086b3">true</span> {
</span></span><span style="display:flex;"><span>        co<span style="color:#000;font-weight:bold">::</span>PoolGuard<span style="color:#000;font-weight:bold">&lt;</span>Connection<span style="color:#000;font-weight:bold">&gt;</span> conn(pool);  <span style="color:#998;font-style:italic">// get a idle connection from the pool
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        conn<span style="color:#000;font-weight:bold">-&gt;</span>send(...);                       <span style="color:#998;font-style:italic">// send request to the server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        conn<span style="color:#000;font-weight:bold">-&gt;</span>recv(...);                       <span style="color:#998;font-style:italic">// recv response from the server
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        process(...);                          <span style="color:#998;font-style:italic">// process the response
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> (over) conn<span style="color:#000;font-weight:bold">-&gt;</span>close(...);            <span style="color:#998;font-style:italic">// close the connection
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go(client_fun);
</span></span></code></pre></div><ul>
<li>co::PoolGuard ÊûÑÈÄ†Êó∂Ëá™Âä®‰ªé co::Pool ‰∏≠Ëé∑Âèñ‰∏Ä‰∏™Á©∫Èó≤ËøûÊé•ÔºåÊûêÊûÑÊó∂Ëá™Âä®Â∞ÜËØ•ËøûÊé•ÊîæÂä† co::Pool ‰∏≠„ÄÇ</li>
</ul>
<h2 id="ÈÖçÁΩÆ"><a class="anchor" href="#%e9%85%8d%e7%bd%ae">#</a>ÈÖçÁΩÆ</h2>
<h3 id="co_debug_log"><a class="anchor" href="#co_debug_log">#</a>co_debug_log</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DEF_bool(co_debug_log, <span style="color:#0086b3">false</span>, <span style="color:#d14">&#34;#1 enable debug log for coroutine library&#34;</span>);
</span></span></code></pre></div><ul>
<li>ÊâìÂç∞ÂçèÁ®ãÁõ∏ÂÖ≥ÁöÑË∞ÉËØïÊó•ÂøóÔºåÈªòËÆ§‰∏∫ false„ÄÇ</li>
</ul>
<h3 id="co_sched_num"><a class="anchor" href="#co_sched_num">#</a>co_sched_num</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DEF_uint32(co_sched_num, os<span style="color:#000;font-weight:bold">::</span>cpunum(), <span style="color:#d14">&#34;#1 number of coroutine schedulers, default: os::cpunum()&#34;</span>);
</span></span></code></pre></div><ul>
<li>ÂçèÁ®ãË∞ÉÂ∫¶Á∫øÁ®ãÁöÑÊï∞ÈáèÔºåÈªòËÆ§‰∏∫Á≥ªÁªü CPU Ê†∏Êï∞„ÄÇÁõÆÂâçÁöÑÂÆûÁé∞‰∏≠ÔºåËøô‰∏™ÂÄºÊúÄÂ§ß‰πüÊòØÁ≥ªÁªü CPU Ê†∏Êï∞„ÄÇ</li>
</ul>
<h3 id="co_stack_size"><a class="anchor" href="#co_stack_size">#</a>co_stack_size</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DEF_uint32(co_stack_size, <span style="color:#099">1024</span> <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">1024</span>, <span style="color:#d14">&#34;#1 size of the stack shared by coroutines, default: 1M&#34;</span>);
</span></span></code></pre></div><ul>
<li>ÂçèÁ®ãÊ†àÂ§ßÂ∞èÔºåÈªòËÆ§‰∏∫ 1M„ÄÇ</li>
</ul>
<h3 id="disable_hook_sleep"><a class="anchor" href="#disable_hook_sleep">#</a>disable_hook_sleep</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DEF_bool(disable_hook_sleep, <span style="color:#0086b3">false</span>, <span style="color:#d14">&#34;#1 disable hook sleep if true&#34;</span>);
</span></span></code></pre></div><ul>
<li>Á¶ÅÊ≠¢ hook sleep Áõ∏ÂÖ≥ÁöÑ APIÔºåÈªòËÆ§‰∏∫ false„ÄÇ</li>
</ul>
<h3 id="hook_log"><a class="anchor" href="#hook_log">#</a>hook_log</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DEF_bool(hook_log, <span style="color:#0086b3">false</span>, <span style="color:#d14">&#34;#1 enable log for hook if true&#34;</span>);
</span></span></code></pre></div><ul>
<li>ÊâìÂç∞ hook Áõ∏ÂÖ≥ÁöÑÊó•ÂøóÔºåÈªòËÆ§‰∏∫ false„ÄÇ</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

  



  
    
  
    
  


  


<div class="book-languages" tabindex="0" aria-haspopup="true">
  <ul>
    <li class="flex align-center">
      <img src="../../../svg/translate.svg" class="book-icon" alt="Languages" />
      ‰∏≠Êñá
    </li> 
  </ul>

  <ul class="book-languages-list">
    
    <li class="active">
      <a href="../../../cn/" class="flex align-center">
        <img src="../../../svg/translate.svg" class="book-icon" alt="Languages" />
        ‰∏≠Êñá
      </a>
    </li>
    
    <li class="">
      <a href="../../../en/co/coroutine/" class="flex align-center">
        <img src="../../../svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </li>
    
  </ul>
</div>




  <div class="book-date"><a class="flex align-center" href="https://github.com/cocoyaxi/codoc/commit/8f91caf0a938c19fe549b8d0fdd1771a2d67c525" title='ÊúÄÂêé‰øÆÊîπËÄÖ idealvin | August 14, 2022' target="_blank" rel="noopener">
      <img src="../../../svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>August 14, 2022</span>
    </a>
  </div>



  <div class="book-edit">
    <a class="flex align-center" href="https://github.com/cocoyaxi/codoc/edit/master/content/cn/co/coroutine.md" target="_blank" rel="noopener">
      <img src="../../../svg/edit.svg" class="book-icon" alt="Edit" />
      <span>ÁºñËæëÊú¨È°µ</span>
    </a>
  </div>

</div>

 
        





<script src="//cdn.bootcss.com/highlight.js/11.1.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/11.1.0/languages/cpp.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/11.1.0/languages/bash.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/11.1.0/languages/lua.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/11.1.0/languages/yaml.min.js"></script>
<script>hljs.configure({ languages: [] }); hljs.initHighlightingOnLoad();</script>





      </footer>

      
  
  <div class="book-comments">


<link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.7.2/gitalk.min.css">
<script src="//cdn.bootcss.com/gitalk/1.7.2/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: '11f9ff9ca43804d70b32',
    clientSecret: '07e2bd5b09a1654e7942a7698c3ec164e7566177',
    repo: 'gitalk',
    owner: 'idealvin',
    admin: ['idealvin'],
    id: location.pathname,
    language: 'zh-CN',
    distractionFreeMode: false,
    proxy: 'https:\/\/cors-anywhere.azm.workers.dev\/https:\/\/github.com\/login\/oauth\/access_token'
  })
  gitalk.render('gitalk-container');
</script></div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#Âü∫Êú¨Ê¶ÇÂøµ">Âü∫Êú¨Ê¶ÇÂøµ</a></li>
        <li><a href="#ÂçèÁ®ã-api">ÂçèÁ®ã API</a>
          <ul>
            <li><a href="#v30-Âà†Èô§ÁöÑ-api">v3.0 Âà†Èô§ÁöÑ API</a></li>
            <li><a href="#go">go</a></li>
            <li><a href="#def_main">DEF_main</a></li>
            <li><a href="#cocoroutine">co::coroutine</a></li>
            <li><a href="#coresume">co::resume</a></li>
            <li><a href="#coyield">co::yield</a></li>
            <li><a href="#coscheduler">co::scheduler</a></li>
            <li><a href="#coschedulers">co::schedulers</a></li>
            <li><a href="#conext_scheduler">co::next_scheduler</a></li>
            <li><a href="#coscheduler_num">co::scheduler_num</a></li>
            <li><a href="#coscheduler_id">co::scheduler_id</a></li>
            <li><a href="#cocoroutine_id">co::coroutine_id</a></li>
            <li><a href="#cosleep">co::sleep</a></li>
            <li><a href="#cotimeout">co::timeout</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÂåñÁöÑ-socket-api">ÂçèÁ®ãÂåñÁöÑ socket API</a>
          <ul>
            <li><a href="#ÊúØËØ≠Á∫¶ÂÆöÂøÖÁúã">ÊúØËØ≠Á∫¶ÂÆö(ÂøÖÁúã)</a></li>
            <li><a href="#cosocket">co::socket</a></li>
            <li><a href="#coaccept">co::accept</a></li>
            <li><a href="#cobind">co::bind</a></li>
            <li><a href="#coclose">co::close</a></li>
            <li><a href="#coconnect">co::connect</a></li>
            <li><a href="#colisten">co::listen</a></li>
            <li><a href="#corecv">co::recv</a></li>
            <li><a href="#corecvn">co::recvn</a></li>
            <li><a href="#corecvfrom">co::recvfrom</a></li>
            <li><a href="#cosend">co::send</a></li>
            <li><a href="#cosendto">co::sendto</a></li>
            <li><a href="#coshutdown">co::shutdown</a></li>
            <li><a href="#coerror">co::error</a></li>
            <li><a href="#costrerror">co::strerror</a></li>
            <li><a href="#heading">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</a></li>
            <li><a href="#cogetsockopt">co::getsockopt</a></li>
            <li><a href="#cosetsockopt">co::setsockopt</a></li>
            <li><a href="#coset_nonblock">co::set_nonblock</a></li>
            <li><a href="#coset_reuseaddr">co::set_reuseaddr</a></li>
            <li><a href="#coset_recv_buffer_size">co::set_recv_buffer_size</a></li>
            <li><a href="#coset_send_buffer_size">co::set_send_buffer_size</a></li>
            <li><a href="#coset_tcp_keepalive">co::set_tcp_keepalive</a></li>
            <li><a href="#coset_tcp_nodelay">co::set_tcp_nodelay</a></li>
            <li><a href="#coreset_tcp_socket">co::reset_tcp_socket</a></li>
            <li><a href="#heading-1">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</a></li>
            <li><a href="#coinit_ip_addr">co::init_ip_addr</a></li>
            <li><a href="#coip_str">co::ip_str</a></li>
            <li><a href="#coto_string">co::to_string</a></li>
            <li><a href="#copeer">co::peer</a></li>
          </ul>
        </li>
        <li><a href="#channelcochan">channel(co::Chan)</a>
          <ul>
            <li><a href="#chanchan">Chan::Chan</a></li>
            <li><a href="#operator">operator&laquo;</a></li>
            <li><a href="#operator-1">operator&raquo;</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-1">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÂêåÊ≠•‰∫ã‰ª∂coevent">ÂçèÁ®ãÂêåÊ≠•‰∫ã‰ª∂(co::Event)</a>
          <ul>
            <li><a href="#eventevent">Event::Event</a></li>
            <li><a href="#eventsignal">Event::signal</a></li>
            <li><a href="#eventwait">Event::wait</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-2">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#waitgroupcowaitgroup">waitgroup(co::WaitGroup)</a>
          <ul>
            <li><a href="#waitgroupwaitgroup">WaitGroup::WaitGroup</a></li>
            <li><a href="#waitgroupadd">WaitGroup::add</a></li>
            <li><a href="#waitgroupdone">WaitGroup::done</a></li>
            <li><a href="#waitgroupwait">WaitGroup::wait</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-3">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÈîÅcomutex">ÂçèÁ®ãÈîÅ(co::Mutex)</a>
          <ul>
            <li><a href="#mutexmutex">Mutex::Mutex</a></li>
            <li><a href="#mutexlock">Mutex::lock</a></li>
            <li><a href="#mutextry_lock">Mutex::try_lock</a></li>
            <li><a href="#mutexunlock">Mutex::unlock</a></li>
          </ul>
        </li>
        <li><a href="#comutexguard">co::MutexGuard</a>
          <ul>
            <li><a href="#mutexguardmutexguard">MutexGuard::MutexGuard</a></li>
            <li><a href="#mutexguardmutexguard-1">MutexGuard::~MutexGuard</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-4">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ãÊ±†copool">ÂçèÁ®ãÊ±†(co::Pool)</a>
          <ul>
            <li><a href="#poolpool">Pool::Pool</a></li>
            <li><a href="#poolclear">Pool::clear</a></li>
            <li><a href="#poolpop">Pool::pop</a></li>
            <li><a href="#poolpush">Pool::push</a></li>
            <li><a href="#poolsize">Pool::size</a></li>
          </ul>
        </li>
        <li><a href="#copoolguard">co::PoolGuard</a>
          <ul>
            <li><a href="#poolguardpoolguard">PoolGuard::PoolGuard</a></li>
            <li><a href="#poolguardpoolguard-1">PoolGuard::~PoolGuard</a></li>
            <li><a href="#poolguardget">PoolGuard::get</a></li>
            <li><a href="#poolguardoperator-">PoolGuard::operator-&gt;</a></li>
            <li><a href="#poolguardoperator">PoolGuard::operator*</a></li>
            <li><a href="#poolguardoperator-bool">PoolGuard::operator bool</a></li>
            <li><a href="#poolguardoperator-1">PoolGuard::operator!</a></li>
            <li><a href="#poolguardoperator-2">PoolGuard::operator==</a></li>
            <li><a href="#poolguardoperator-3">PoolGuard::operator!=</a></li>
            <li><a href="#poolguardoperator-4">PoolGuard::operator=</a></li>
            <li><a href="#poolguardreset">PoolGuard::reset</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-5">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#io-‰∫ã‰ª∂coioevent">I/O ‰∫ã‰ª∂(co::IoEvent)</a>
          <ul>
            <li><a href="#coio_event_t">co::io_event_t</a></li>
            <li><a href="#ioeventioevent">IoEvent::IoEvent</a></li>
            <li><a href="#ioeventioevent-1">IoEvent::~IoEvent</a></li>
            <li><a href="#ioeventwait">IoEvent::wait</a></li>
            <li><a href="#‰ª£Á†ÅÁ§∫‰æã-6">‰ª£Á†ÅÁ§∫‰æã</a></li>
          </ul>
        </li>
        <li><a href="#ÂçèÁ®ã‰∏≠‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ì">ÂçèÁ®ã‰∏≠‰ΩøÁî®‰∏âÊñπÁΩëÁªúÂ∫ì</a>
          <ul>
            <li><a href="#ÂçèÁ®ãÂåñ">ÂçèÁ®ãÂåñ</a></li>
            <li><a href="#Á≥ªÁªü-api-hook">Á≥ªÁªü API hook</a></li>
          </ul>
        </li>
        <li><a href="#Âü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ãÊ®°Âºè">Âü∫‰∫éÂçèÁ®ãÁöÑÁΩëÁªúÁºñÁ®ãÊ®°Âºè</a>
          <ul>
            <li><a href="#ÊúçÂä°Á´ØÁΩëÁªúÊ®°Âûã">ÊúçÂä°Á´ØÁΩëÁªúÊ®°Âûã</a></li>
            <li><a href="#ÂÆ¢Êà∑Á´ØÁΩëÁªúÊ®°Âûã">ÂÆ¢Êà∑Á´ØÁΩëÁªúÊ®°Âûã</a></li>
          </ul>
        </li>
        <li><a href="#ÈÖçÁΩÆ">ÈÖçÁΩÆ</a>
          <ul>
            <li><a href="#co_debug_log">co_debug_log</a></li>
            <li><a href="#co_sched_num">co_sched_num</a></li>
            <li><a href="#co_stack_size">co_stack_size</a></li>
            <li><a href="#disable_hook_sleep">disable_hook_sleep</a></li>
            <li><a href="#hook_log">hook_log</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












